# Universal Agent Instructions

**Last updated:** {{DATE}}

This project uses LumenFlow workflow. For complete documentation, see [LUMENFLOW.md](LUMENFLOW.md).

---

## Quick Start

```bash
# 1. Claim a WU
pnpm wu:claim --id WU-XXXX --lane <Lane>
cd worktrees/<lane>-wu-xxxx

# 2. Work in worktree, run gates
pnpm gates

# 3. Complete (ALWAYS run this!)
cd <project-root>
pnpm wu:done --id WU-XXXX
```

> **Complete CLI reference:** See [quick-ref-commands.md]({{QUICK_REF_LINK}})

---

## Critical: Always wu:done

After completing work, ALWAYS run `pnpm wu:done --id WU-XXXX` from the main checkout.

This is the single most forgotten step. See [LUMENFLOW.md](LUMENFLOW.md) for details.

---

## Essential Commands

| Command                   | Description                                           |
| ------------------------- | ----------------------------------------------------- |
| `pnpm wu:create`          | Create new WU spec (ID auto-generated)                |
| `pnpm wu:claim`           | Claim WU and create worktree (or `--cloud`)           |
| `pnpm wu:prep`            | Run gates in worktree, prep for wu:done               |
| `pnpm wu:done`            | Complete WU (merge or PR, stamp, cleanup)             |
| `pnpm wu:status`          | Show WU status, location, valid commands              |
| `pnpm wu:brief`           | Generate handoff prompt + record evidence             |
| `pnpm wu:delegate`        | Generate prompt + record delegation lineage           |
| `pnpm wu:recover`         | Analyze and fix WU state inconsistencies              |
| `pnpm wu:escalate`        | Show or resolve WU escalation status                  |
| `pnpm wu:delete`          | Delete WU spec and cleanup                            |
| `pnpm gates`              | Run all quality gates (`--docs-only` for docs)        |
| `pnpm lumenflow:commands` | List all public commands (primary + aliases + legacy) |
| `pnpm mem:checkpoint`     | Save progress checkpoint                              |
| `pnpm mem:recover`        | Generate recovery context                             |

---

## Core Principles

1. **TDD**: Write tests first, then implementation
2. **Worktree Discipline**: After `wu:claim`, work ONLY in the worktree
3. **Gates Before Done**: Run `pnpm gates` before `wu:done`
4. **Never Bypass Hooks**: No `--no-verify`

---

## Forbidden Commands

- `git reset --hard`
- `git push --force`
- `git stash` (on main)
- `--no-verify`

---

## Vendor-Specific Overlays

This file provides universal guidance for all AI agents. Additional vendor-specific configuration:

- **Claude Code**: See `CLAUDE.md` (if present)
- **Cursor**: See `.cursor/rules/lumenflow.md` (if present)
- **Windsurf**: See `.windsurf/rules/lumenflow.md` (if present)

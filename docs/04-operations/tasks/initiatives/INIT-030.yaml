id: INIT-030
slug: runtime-adoption-strangler-fig
title: KernelRuntime Adoption and Command Migration
description: 'Feature-forward runtime adoption plan after INIT-029: complete remaining constant
  extraction, migrate command execution from CLI shell-outs to direct KernelRuntime calls in
  existing MCP/CLI packages, and close adoption metrics using a parity-safe strangler migration.'
status: in_progress
priority: P1
owner: 'Framework: Core'
created: 2026-02-17
target_date: 2026-07-31
phases:
  - id: 1
    title: 'Foundation: remaining DRY/constants extraction'
    status: done
  - id: 2
    title: Command migration in existing MCP/CLI packages
    status: done
  - id: 3
    title: Pack workflow expression via runtime
    status: done
  - id: 4
    title: Metric closure and runCliCommand deprecation path
    status: done
  - id: 5
    title: 'Kernel hardening: security fail-close, durability, governance, fuzz testing'
    status: done
  - id: 6
    title: Software-delivery pack completion and runtime migration quality
    status: in_progress
success_metrics:
  - Migrated commands execute through KernelRuntime without runCliCommand shell-out
  - MCP and CLI parity gates remain green for migrated commands
  - Runtime adoption proceeds in old production packages via strangler-fig migration
  - MCP shell-out call sites in `packages/@lumenflow/mcp/src/tools/*.ts` remain non-increasing from
    baseline 100 and ratchet to timeline checkpoints in the INIT-030 roadmap artifact
  - All kernel policy denials are fail-closed — no CLI fallback bypass (WU-1859)
  - Evidence store handles crash recovery with no lock leaks, clock skew, or partial writes (WU-1860)
  - JSONL trace compaction and O(1) incremental replay at scale (WU-1862)
  - ToolHost construction requires explicit policy — no silent privilege escalation (WU-1863)
  - Scope intersection glob heuristic verified by property-based fuzz tests against micromatch
    oracle (WU-1864)
  - Zero dead code in kernel packages, single source of truth for state machine (WU-1865)
labels: []
wus:
  - WU-1784
  - WU-1785
  - WU-1786
  - WU-1787
  - WU-1788
  - WU-1789
  - WU-1793
  - WU-1795
  - WU-1794
  - WU-1815
  - WU-1848
  - WU-1849
  - WU-1850
  - WU-1859
  - WU-1860
  - WU-1861
  - WU-1862
  - WU-1863
  - WU-1864
  - WU-1865
  - WU-1866
  - WU-1867
  - WU-1868
  - WU-1884
  - WU-1885
  - WU-1886
  - WU-1887
  - WU-1888
  - WU-1889
  - WU-1890
  - WU-1891
  - WU-1892
  - WU-1893
  - WU-1894
  - WU-1895
  - WU-1896
  - WU-1897
  - WU-1903
  - WU-1904
  - WU-1905
notes:
  - '2026-02-19: Phase 6 activated for software-delivery migration stream (WU-1884..WU-1897).'

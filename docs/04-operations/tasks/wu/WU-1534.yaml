id: WU-1534
title: Harden CLI command execution surfaces
lane: 'Framework: CLI Enforcement'
type: bug
status: done
priority: P0
created: 2026-02-09
code_paths:
  - packages/@lumenflow/cli/src/deps-add.ts
  - packages/@lumenflow/cli/src/deps-remove.ts
  - packages/@lumenflow/cli/src/trace-gen.ts
  - packages/@lumenflow/cli/src/__tests__/deps-operations.test.ts
  - packages/@lumenflow/cli/src/__tests__/trace-gen.test.ts
tests:
  manual:
    - Run targeted CLI calls with malformed package and WU ID inputs; verify no shell execution side
      effects.
  unit:
    - packages/@lumenflow/cli/src/__tests__/deps-operations.test.ts
    - packages/@lumenflow/cli/src/__tests__/trace-gen.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1534.done
dependencies: []
initiative: INIT-020
phase: 1
spec_refs:
  - lumenflow://plans/polished-frolicking-whale.md
risks: []
notes: |-
  Track A from enterprise hardening initiative.
  Initial release happened during a re-claim cycle on 2026-02-09, but the final WU delivery completed implementation:
  deps-add/deps-remove/trace-gen were migrated to argv-based execution with strict argument validation and injection hardening.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Several CLI commands currently construct shell command strings from CLI
  input. Problem: untrusted arguments can trigger command injection via shell interpretation.
  Solution: migrate affected commands to argv-based process execution and enforce strict input
  validation for package names and WU IDs.'
acceptance:
  - deps-add and deps-remove execute via argv-based process APIs without shell interpolation.
  - trace-gen uses argv-based git invocations and no shell pipe composition.
  - Injection-focused tests cover malicious argument cases and pass.
claimed_mode: worktree
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-09T22:51:56.738Z
worktree_path: /home/USER/source/hellmai/os/worktrees/framework-cli-enforcement-wu-1534
claimed_at: 2026-02-09T22:51:56.735Z
baseline_main_sha: 6bb16006cf1e24144cae4d0070404eb3290671c2
session_id: 284d882f-ecf2-4c8d-a361-f60a56c5fdfc
locked: true
completed: 2026-02-09

id: WU-1282
title: 'Bug: Task-spawned sub-agents bypass PreToolUse hooks'
lane: 'Framework: Core'
type: bug
status: ready
priority: P1
created: 2026-01-31
code_paths:
  - .claude/hooks/validate-worktree-path.sh
  - .claude/settings.json
tests:
  manual:
    - Spawn sub-agent via Task tool and verify hooks are enforced
  unit: []
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1282.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Task-spawned sub-agents via Task tool do not inherit PreToolUse hooks from parent session. The validate-worktree-path.sh hook did not run for a spawned agent, allowing it to write to main repo (cli.mdx) while worktrees existed. This is a security gap - agents can bypass safety hooks by spawning sub-agents. Discovered during INIT-008 Wave 0 execution.
acceptance:
  - Investigate why hooks don't propagate to Task-spawned agents
  - Document root cause and propose fix
  - Implement fix to ensure hooks run in sub-agents

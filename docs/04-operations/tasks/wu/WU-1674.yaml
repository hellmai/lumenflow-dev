id: WU-1674
title: Atomic spawn-to-delegation runtime rename with migration guard
lane: 'Framework: Core Lifecycle'
type: refactor
status: in_progress
priority: P0
created: 2026-02-14
code_paths:
  - packages/@lumenflow/core/src/wu-state-store.ts
  - packages/@lumenflow/core/src/wu-state-schema.ts
  - packages/@lumenflow/core/src/lumenflow-config-schema.ts
  - packages/@lumenflow/core/src/schemas/setup-schemas.ts
  - packages/@lumenflow/core/src/schemas/setup-arg-validators.ts
  - packages/@lumenflow/core/src/template-loader.ts
  - packages/@lumenflow/core/src/wu-paths-constants.ts
  - packages/@lumenflow/core/src/wu-spawn-context.ts
  - packages/@lumenflow/core/src/delegation-registry-schema.ts
  - packages/@lumenflow/core/src/delegation-tree.ts
  - packages/@lumenflow/core/src/index.ts
  - packages/@lumenflow/cli/src/delegation-list.ts
  - packages/@lumenflow/cli/src/mem-context.ts
  - packages/@lumenflow/cli/src/public-manifest.ts
  - packages/@lumenflow/mcp/src/tools/orchestration-tools.ts
  - packages/@lumenflow/mcp/src/tools.ts
  - packages/@lumenflow/core/src/delegation-registry-store.ts
  - packages/@lumenflow/core/src/delegation-monitor.ts
  - packages/@lumenflow/core/src/delegation-recovery.ts
  - packages/@lumenflow/core/src/delegation-escalation.ts
  - packages/@lumenflow/cli/src/orchestrate-monitor.ts
  - packages/@lumenflow/cli/src/wu-claim-state.ts
  - packages/@lumenflow/cli/src/wu-done.ts
  - packages/@lumenflow/core/src/wu-spawn-helpers.ts
tests:
  manual:
    - Simulate first-run with legacy state files and verify archive + rebootstrap complete without
      manual intervention
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-state-store.test.ts
    - packages/@lumenflow/core/src/__tests__/schema-parity.test.ts
    - packages/@lumenflow/cli/__tests__/wu-spawn.test.ts
    - packages/@lumenflow/mcp/src/__tests__/coordination-tools.test.ts
    - packages/@lumenflow/core/src/__tests__/spawn-monitor.test.ts
    - packages/@lumenflow/cli/__tests__/orchestrate-monitor.test.ts
    - packages/@lumenflow/cli/__tests__/orchestrate-monitor-watch.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1674.done
dependencies: []
initiative: INIT-028
phase: 1
spec_refs:
  - docs/04-operations/plans/INIT-028-plan.md
risks: []
notes: INIT-028 WU-A from PLAN-spawn-to-delegation-rename blueprint; includes migration guard +
  mechanical runtime rename.
requires_review: false
claimed_mode: worktree
assigned_to: tom@hellm.ai
claimed_at: 2026-02-14T09:58:33.869Z
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1674
session_id: fd676687-0c3e-4748-ba31-bfab91eaace0
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-14T09:58:33.876Z
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: live runtime still exposes spawn-prefixed commands, modules, schemas, and
  state artifacts. Problem: terminology drift and mixed semantics create governance and operational
  risk. Solution: deliver a clean-slate rename to delegation surfaces with first-run legacy state
  auto-archive and state rebootstrap.'
acceptance:
  - No live command/tool/module runtime path requires spawn-prefixed interfaces.
  - First run with legacy state auto-archives spawn-era files and reboots state successfully.
  - delegation:list and delegation_list succeed while spawn:list/spawn_list are removed from active
    registries.
  - Old config key memory.spawn_context_max_size and old CLI flag --spawn-context-max-size hard-fail
    with explicit guidance.
  - Typecheck and targeted parity suites pass after rename migration.

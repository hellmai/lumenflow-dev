id: WU-1848
title: Extract duplicated string literal constants into shared-constants module
lane: 'Framework: Core Lifecycle'
type: refactor
status: ready
priority: P2
created: 2026-02-18
code_paths:
  - packages/@lumenflow/kernel/src/shared-constants.ts
  - packages/@lumenflow/kernel/src/kernel.schemas.ts
  - packages/@lumenflow/kernel/src/tool-host/tool-host.ts
  - packages/@lumenflow/kernel/src/event-store
  - packages/@lumenflow/kernel/src/sandbox/subprocess-dispatcher.ts
  - packages/@lumenflow/kernel/src/sandbox/tool-runner-worker.ts
  - packages/@lumenflow/kernel/src/pack/pack-loader.ts
  - packages/@lumenflow/mcp/src/tools-shared.ts
  - packages/@lumenflow/packs/software-delivery/tool-impl/git-tools.ts
  - packages/@lumenflow/packs/software-delivery/tool-impl/worktree-tools.ts
  - packages/@lumenflow/cli/src/task-claim.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/kernel/tests/shared-constants.test.ts
    - packages/@lumenflow/kernel/tests/tool-host.test.ts
    - packages/@lumenflow/kernel/tests/pack-loader.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1848.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Multiple packages duplicate the same regex patterns, error code strings, and configuration constants. Extract into a shared-constants module to enforce DRY and prevent drift.
acceptance:
  - SEMVER_REGEX defined once in shared-constants.ts and re-exported
  - SHA256_HEX_REGEX defined once (currently duplicated in kernel.schemas.ts AND tool-host.ts)
  - KERNEL_POLICY_IDS enum replaces 4+ inline policy-id strings
  - Event kind strings (tool_call_start etc) use TOOL_TRACE_KINDS constants everywhere
  - UTF8_ENCODING constant replaces bare utf-8 strings in runtime package
  - Policy trigger strings (on_tool_call etc) use shared enum
  - DEFAULT_WORKSPACE_ROOT consolidated from 7 separate declarations in task-claim.ts
  - No bare string literals for any of the above remain in kernel, mcp, packs, runtime packages
  - All existing tests pass unchanged

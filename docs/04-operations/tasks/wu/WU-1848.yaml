id: WU-1848
title: Standardize kernel identifier constants with typed source-of-truth modules
lane: 'Framework: Core Lifecycle'
type: refactor
status: in_progress
priority: P1
created: 2026-02-18
code_paths:
  - packages/@lumenflow/kernel/src/shared-constants.ts
  - packages/@lumenflow/kernel/src/kernel.schemas.ts
  - packages/@lumenflow/kernel/src/runtime/kernel-runtime.ts
  - packages/@lumenflow/kernel/src/tool-host/tool-host.ts
  - packages/@lumenflow/kernel/src/tool-host/builtins/capabilities.ts
  - packages/@lumenflow/kernel/src/evidence/evidence-store.ts
  - packages/@lumenflow/kernel/src/pack/pack-loader.ts
tests:
  manual:
    - Verify a full task lifecycle emits the same event/error identifiers before and after refactor
  unit:
    - packages/@lumenflow/kernel/src/__tests__/kernel.schemas.test.ts
    - packages/@lumenflow/kernel/src/__tests__/runtime.test.ts
    - packages/@lumenflow/kernel/src/__tests__/tool-host.test.ts
    - packages/@lumenflow/kernel/src/__tests__/evidence-store.test.ts
    - packages/@lumenflow/kernel/src/__tests__/pack-loader.test.ts
    - packages/@lumenflow/kernel/src/__tests__/shared-constants.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1848.done
dependencies: []
initiative: INIT-030
phase: 3
blocked_by:
  - WU-1843
  - WU-1847
spec_refs:
  - /home/tom/.claude/plans/adaptive-finding-adleman.md
  - /home/tom/.claude/plans/zesty-jumping-pixel.md
risks:
  - Schema/value drift can regress runtime validation if constant-backed literals diverge.
  - Parallel edits to pack-loader and tool-host from related remediation WUs can cause merge churn;
    sequence integration carefully.
  - Over-centralization can reduce local readability if governance families are not narrowly scoped.
notes: Kernel-only scope for WU-1848. MCP surface literal governance (parity-tools
  command/flag/metadata ratchet) is handled in a separate WU to reduce blast radius and merge
  conflicts.
requires_review: false
claimed_mode: worktree
assigned_to: tom@hellm.ai
claimed_at: 2026-02-18T11:43:24.315Z
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1848
session_id: c0fc26b8-6ca6-440d-b4df-5fece916268d
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-18T11:43:24.320Z
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: kernel runtime paths still contain repeated security-sensitive identifier
  literals (policy IDs, reserved-path boundaries, integrity markers, default sentinels, and path
  segment constants) across schemas, runtime, tool-host, evidence, and pack loader code. Problem:
  duplicated identifiers are drift-prone and can introduce typo defects in boundary enforcement
  paths. Solution: deliver a kernel-only literal governance wave with typed source-of-truth constant
  modules (as const objects + derived union types + guard helpers) and enforce imports from those
  modules in touched kernel files.'
acceptance:
  - 'Introduce canonical kernel constant groups for targeted families: policy IDs/triggers, reserved
    framework scope boundaries, integrity prefixes/regex, default sentinel identifiers, and repeated
    runtime path-segment identifiers.'
  - Existing centralized families (KERNEL_EVENT_KINDS, TOOL_TRACE_KINDS, TOOL_ERROR_CODES) are
    treated as import-enforced sources of truth; touched files must import them rather than
    duplicate inline literals.
  - Zod schemas in kernel runtime continue to validate with unchanged external behavior while using
    constant-backed literals/enums for targeted families.
  - Exported types are derived from constant objects/tuples (single source of truth), with guard
    helpers where runtime narrowing is needed.
  - No breaking public API changes to @lumenflow/kernel or @lumenflow/mcp exports; refactoring
    remains internal to module implementation.
  - Add or update unit tests covering constant/type wiring and regressions for targeted kernel
    families.
  - No duplicate definitions remain for targeted kernel families outside approved constants modules
    (tests may still assert literal values).

id: WU-1158
title: 'Bug: Validators use hardcoded paths instead of config'
lane: 'Framework: Core'
type: bug
status: done
priority: P1
created: 2026-01-28
code_paths:
  - packages/@lumenflow/core/src/validators/backlog-sync.ts
  - packages/@lumenflow/core/src/wu-consistency-checker.ts
  - packages/@lumenflow/agent/src/agent-verification.ts
  - packages/@lumenflow/memory/src/mem-triage-core.ts
  - packages/@lumenflow/core/src/wu-yaml.ts
  - packages/@lumenflow/core/src/wu-done-pr.ts
  - packages/@lumenflow/cli/src/initiative-bulk-assign-wus.ts
  - packages/@lumenflow/cli/src/metrics-cli.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/core/src/__tests__/validators/backlog-sync.test.ts
    - packages/@lumenflow/agent/__tests__/agent-verification.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1158.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: >-
  Context: LumenFlow validators (backlog-sync, wu-consistency-checker, agent-verification) and
  several CLI commands have hardcoded paths like docs/04-operations/tasks/wu/ instead of reading
  from .lumenflow.config.yaml.


  Problem: Consumer repos that use different WU storage paths (e.g., .lumenflow/wus/) cannot pass
  gates because validators check the wrong directory. The config schema supports directories.wuDir
  but validators ignore it.


  Impact: ExampleApp agents experienced repeated gate failures despite correct config. They had to
  use skip-gates as workaround, degrading workflow confidence.


  Solution: Refactor all hardcoded path references to use the config-aware WU_PATHS helper from
  wu-paths.ts or loadConfig() from lumenflow-config.ts. Keep current paths as defaults for backwards
  compatibility.


  AGENT INSTRUCTIONS:


  1. Find all hardcoded path references in code_paths files

  2. Replace with WU_PATHS helper or loadConfig() calls

  3. Ensure defaults remain docs/04-operations/tasks/wu for backwards compat

  4. Add unit tests for custom wuDir configuration

  5. Test manually: configure wuDir in .lumenflow.config.yaml and run pnpm gates
acceptance:
  - All validators read wuDir/backlogPath from .lumenflow.config.yaml
  - Validators use WU_PATHS helper or loadConfig() - no hardcoded path strings
  - Default paths remain docs/04-operations/tasks/wu for backwards compatibility
  - Unit tests cover custom wuDir configuration
  - Consumer repo with .lumenflow/wus/ passes gates without skip-gates
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-wu-1158
claimed_at: 2026-01-28T11:20:04.574Z
baseline_main_sha: aca6e769178f0ef687dbc0c34ec1b77208b47967
session_id: 852fff34-1ca3-4627-81dd-41dd7408508e
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-28T11:20:04.579Z
locked: true
completed_at: 2026-01-28T12:18:11.745Z

id: WU-1127
title: lumenflow:upgrade must use micro-worktree (users blocked from upgrading)
lane: 'Framework: CLI'
type: bug
status: ready
priority: P0
created: 2026-01-26
code_paths:
  - packages/@lumenflow/cli/src/lumenflow-upgrade.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/cli/src/__tests__/lumenflow-upgrade.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1127.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "REAL USER IMPACT: ExampleApp agent tried to upgrade to 2.1.0 and hit massive friction - hook blocked pnpm up on main, had to create WU (3 attempts), claim failed once, virtual store issues, etc. All just to upgrade packages\\! The lumenflow:upgrade command requires users to be inside a worktree but doesn't use micro-worktree isolation. This creates a paradox: users must break LumenFlow rules to upgrade LumenFlow. Command should use micro-worktree like wu:create/wu:edit do."
acceptance:
  - lumenflow:upgrade uses micro-worktree isolation pattern
  - Command runs from main checkout without requiring user worktree
  - Changes to package.json and lockfile are atomic via micro-worktree
  - Existing --dry-run and --latest flags still work
  - Unit tests verify micro-worktree behavior

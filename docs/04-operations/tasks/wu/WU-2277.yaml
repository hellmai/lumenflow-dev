id: WU-2277
title: Fix require-wu path scope to repo
lane: 'Framework: CLI Enforcement'
type: feature
status: in_progress
priority: P2
created: 2026-02-28
code_paths:
  - packages/@lumenflow/cli/src/hooks/**
tests:
  manual:
    - Verify Write/Edit to /tmp and ~/.claude do not require claimed WU while repo writes still do
  unit:
    - packages/@lumenflow/cli/src/__tests__/hooks/enforcement.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2277.done
dependencies: []
spec_refs:
  - lumenflow://plans/WU-2277-plan.md
risks: []
notes: >-
  Scope require-wu to repository writes only; canonicalize file_path in generated
  hook and runtime parity check. Plan ref: ~/.lumenflow/plans/WU-2277-plan.md
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: require-wu hook currently blocks Write/Edit outside repo because it only checks claimed
  WU state. Add path-aware repo boundary check so enforcement applies only to repo writes.
acceptance:
  - Outside-repo writes (including /tmp and home-relative paths) are allowed without WU; in-repo
    writes still require claimed WU; generated hook script and runtime checks stay consistent.
claimed_mode: worktree
worktree_path: worktrees/framework-cli-enforcement-wu-2277
claimed_at: 2026-02-28T15:35:01.622Z
baseline_main_sha: 7574d83fd4fce3bfce3ccef1f3d3623415e2182e
session_id: e7dd7574-85cd-48c0-a47c-2c31024d998c
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-28T15:35:01.628Z

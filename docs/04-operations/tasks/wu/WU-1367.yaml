id: WU-1367
title: 'Claude Code enforcement hooks: configurable workflow compliance via hooks'
lane: 'Framework: CLI'
type: feature
status: in_progress
priority: P2
created: 2026-02-02
code_paths:
  - packages/@lumenflow/cli/src/hooks/
  - packages/@lumenflow/cli/src/commands/integrate.ts
  - packages/@lumenflow/cli/src/commands/setup.ts
  - packages/@lumenflow/core/src/config/schema.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/cli/src/__tests__/hooks/enforcement.test.ts
    - packages/@lumenflow/cli/src/__tests__/commands/integrate.test.ts
  e2e:
    - packages/@lumenflow/cli/e2e/claude-enforcement.test.ts
artifacts:
  - .lumenflow/stamps/WU-1367.done
dependencies: []
spec_refs:
  - internal
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Add configurable Claude Code enforcement hooks. When enabled, hooks block
  non-compliant operations (Write/Edit outside worktree, commits without wu:prep) rather than
  relying on agents to remember workflow rules. Addresses the bootstrap problem: agents forget to
  follow LumenFlow even in the LumenFlow repo.'
acceptance:
  - Config schema accepts enforcement block under agents.clients.claude-code
  - pnpm lumenflow:integrate --client claude-code generates hooks in .claude/
  - PreToolUse hook blocks Write/Edit when block_outside_worktree=true and cwd is not a worktree
  - PreToolUse hook blocks Write/Edit when require_wu_for_edits=true and no WU is claimed
  - Stop hook warns when warn_on_stop_without_wu_done=true and session ends without wu:done
  - Hooks degrade gracefully if LumenFlow state cannot be determined
  - pnpm setup syncs hooks when enforcement.hooks=true
  - Documentation updated in CLAUDE.md and agent onboarding docs
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-cli-wu-1367
claimed_at: 2026-02-02T23:57:25.649Z
baseline_main_sha: c7b8a95f1647e67884df0a457222bc60e64be8d6
session_id: b44b24b9-29f7-4899-9c2e-6eddf30a9205
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-02T23:57:25.656Z

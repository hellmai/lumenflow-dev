id: WU-1767
title: Harden lane lock CAS and migrate pack-owned runtime paths
lane: 'Framework: Core Lifecycle'
type: bug
status: ready
priority: P1
created: 2026-02-17
code_paths:
  - packages/@lumenflow/packs/software-delivery/tool-impl/lane-lock.ts
  - packages/@lumenflow/packs/software-delivery/tools/lane-lock-tool.ts
  - packages/@lumenflow/packs/software-delivery/tool-impl/delegation-tools.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/packs/software-delivery/__tests__/lane-lock.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1767.done
dependencies: []
initiative: INIT-029
phase: 6
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Lane lock stale takeover currently uses a read-check-write flow that can race under contention. Pack-owned lock and state artifacts also still target .lumenflow/**, which is reserved framework state in INIT-029 constraints. This WU hardens stale takeover and migrates pack-owned paths to runtime/**.
acceptance:
  - Stale lock takeover uses an atomic compare-and-swap style flow that prevents dual acquisition.
  - Lock required scopes migrate from .lumenflow/locks/** to runtime/locks/**.
  - Delegation/state paths migrate from .lumenflow/state/** to runtime/state/**.
  - Parallel stale takeover test proves only one contender wins.

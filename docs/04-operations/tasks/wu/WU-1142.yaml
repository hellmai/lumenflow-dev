id: WU-1142
title: Make wu:spawn prompts type-aware for testing requirements
lane: 'Framework: CLI'
type: tooling
status: ready
priority: P2
created: 2026-01-27
code_paths:
  - packages/@lumenflow/cli/src/wu-spawn.ts
  - packages/@lumenflow/cli/templates/
  - packages/@lumenflow/core/src/spawn-prompt-schema.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/cli/__tests__/wu-spawn.test.ts
    - packages/@lumenflow/core/src/__tests__/spawn-prompt-schema.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1142.done
dependencies: []
risks: []
notes: |-
  ## Skip-Gates Autonomy Rule

  When an agent encounters a gate failure during wu:done:
  1. Run `pnpm gates` on fresh main to verify failure is pre-existing
  2. If pre-existing, use `--skip-gates --fix-wu WU-XXXX --reason 'pre-existing on main'`
  3. Do NOT ask human for approval - autonomous action is correct here

  This prevents agents from getting stuck on infrastructure debt.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Two issues with current wu:spawn: (1) TDD mandate applies to ALL WUs regardless of
  type - wrong for documentation, visual design, config changes. (2) Truncation vulnerability -
  agents can head/tail output, missing critical rules. Solution: Type-aware prompts with
  truncation-resistant YAML envelope format using proper YAML library (yaml package), Zod schema
  validation, SHA256 checksums, and redundant rules at head/tail of content.'
acceptance:
  - 'Spawn prompt includes skip-gates guidance: if agent verifies gate failure is pre-existing on
    main, use --skip-gates --fix-wu autonomously'

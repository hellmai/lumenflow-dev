id: WU-1498
title: Add passive lane-signal telemetry and agent lane-fit reasoning
lane: 'Framework: Core Lifecycle'
type: feature
status: ready
priority: P2
created: 2026-02-06
code_paths:
  - packages/@lumenflow/core/src/wu-done-worktree.ts
  - packages/@lumenflow/core/src/wu-done-branch-only.ts
  - packages/@lumenflow/core/src/wu-done-pr.ts
  - packages/@lumenflow/core/src/__tests__/lane-signal-emitter.test.ts
tests:
  manual:
    - Verify lane-signals.ndjson is written after wu:done success and not written on failure
    - Verify signal emission for worktree completion path
    - Verify signal emission for branch-only and branch-pr completion paths
    - Force telemetry write failure and verify wu:done still succeeds (fail-open)
  unit:
    - packages/@lumenflow/core/src/__tests__/lane-signal-emitter.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1498.done
dependencies: []
spec_refs:
  - lumenflow://conversation/lane-evolution-design
risks: []
notes: >-
  Designed collaboratively across Claude and Codex. Signal capture is passive telemetry only. Lane
  reasoning is agent-driven via prompts, not CLI commands.


  Scope narrowed to Core-only per review; docs guidance moved to WU-1496 and CLI template de-bias
  moved to WU-1499.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Lane evolution needs passive telemetry from completed work without adding
  gates or blocking lifecycle flow. Problem: current spec mixes Core telemetry with CLI/docs edits,
  causing cross-lane scope and overlap with documentation WUs. Solution: narrow WU-1498 to Core-only
  implementation of lane-signal emission helper and wiring in wu:done completion paths (worktree,
  branch-only, branch-pr), with fail-open behavior.'
acceptance:
  - wu:done emits one NDJSON line to .lumenflow/telemetry/lane-signals.ndjson with wuId, lane,
    actualFiles, timestamp on success
  - 'Signal emission is fail-open: errors are caught/logged and never block wu:done'
  - Signal emission is invoked for worktree, branch-only, and branch-pr completion paths via shared
    helper

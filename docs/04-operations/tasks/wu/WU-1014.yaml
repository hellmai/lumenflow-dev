id: WU-1014
title: Add error logging to worktreeRemove fallback rmSync
lane: CLI
type: bug
status: done
priority: P2
created: 2026-01-18
code_paths:
  - packages/@lumenflow/core/src/git-adapter.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/core/src/__tests__/git-adapter.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1014.done
dependencies: []
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |
  Add error logging to worktreeRemove fallback rmSync in git-adapter.ts.

  Context: The worktreeRemove function has a "Layer 1 defense" (WU-1476) that
  calls rmSync after git worktree remove succeeds, to handle edge cases where
  the directory is left behind.

  Problem: The rmSync call on line 528 is outside the try-catch block. If it
  throws (permission denied, file locked, etc.), the error propagates with no
  logging about what failed. This makes debugging difficult when wu:done or
  wu:cleanup fails silently.

  Solution: Wrap the fallback rmSync in try-catch with descriptive error
  logging that includes the worktree path and original error message.
acceptance:
  - Fallback rmSync wrapped in try-catch with console.warn logging
  - Log message includes worktree path and error message
  - Unit test covers rmSync throwing after successful git worktree remove
  - pnpm format, lint, typecheck â†’ PASS
claimed_mode: worktree
worktree_path: worktrees/cli-wu-1014
claimed_at: 2026-01-18T21:25:27.742Z
baseline_main_sha: a429935c22bdd520e0c8400e7abefb0df1255135
session_id: c5cd0689-0815-4626-91ed-39668c6db915
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-18T21:25:27.751Z
locked: true
completed_at: 2026-01-18T21:32:07.147Z

id: WU-1491
title: Add wu:claim cloud mode and branch-pr mode resolution
lane: 'Framework: CLI'
type: feature
status: ready
priority: P1
created: 2026-02-06
code_paths:
  - packages/@lumenflow/cli/src/wu-claim.ts
  - packages/@lumenflow/core/src/arg-parser.ts
  - packages/@lumenflow/core/src/schemas/command-schemas.ts
  - packages/@lumenflow/mcp/src/tools.ts
  - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts
  - packages/@lumenflow/core/src/__tests__/arg-parser.test.ts
  - packages/@lumenflow/mcp/src/__tests__/wu-tools.test.ts
tests:
  manual:
    - Validate claim mode outcomes for each flag combination and verify MCP tool argument passthrough.
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts
    - packages/@lumenflow/core/src/__tests__/arg-parser.test.ts
    - packages/@lumenflow/mcp/src/__tests__/wu-tools.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1491.done
dependencies: []
initiative: INIT-016
phase: 2
blocked_by:
  - WU-1490
spec_refs:
  - lumenflow://plans/memoized-baking-sutton.md
risks: []
notes: WU-B from branch-pr cloud initiative plan.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: branch-pr mode needs a claim entrypoint for cloud agents and MCP callers. Problem: wu:claim mode selection currently supports worktree, branch-only, and worktree-pr only. Solution: add --cloud and mode-resolution rules mapping --cloud or --branch-only --pr-mode to branch-pr, while preserving lane-level WIP semantics and MCP passthrough.'
acceptance:
  - wu:claim supports --cloud flag.
  - Mode matrix resolves default/worktree-pr/branch-only/branch-pr correctly, including --branch-only --pr-mode.
  - branch-pr path skips global branch-only singleton guard but keeps lane lock + lane WIP checks.
  - MCP wu_claim schema/args can invoke --cloud, --branch-only, and --pr-mode passthrough.

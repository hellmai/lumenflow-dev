id: WU-1869
title: Vercel Blob-backed PackRegistryStore + PackBlobStore adapters
lane: 'Content: Site Comms'
type: feature
status: ready
priority: P1
created: 2026-02-18
code_paths:
  - apps/web/src/server/pack-registry-store-vercel-blob.ts
  - apps/web/src/server/pack-registry-config.ts
  - apps/web/app/api/registry/packs/[id]/versions/[version]/tarball/route.ts
tests:
  manual:
    - Verify tarball route returns 200 with correct content-type for existing pack
    - Verify tarball route returns 404 for non-existent pack
  unit:
    - apps/web/src/server/__tests__/pack-registry-store-vercel-blob.test.ts
    - apps/web/src/server/__tests__/pack-registry-config.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1869.done
dependencies: []
initiative: INIT-031
phase: 5
spec_refs:
  - .claude/plans/partitioned-sprouting-nest.md
risks: []
notes: 'Sizing: Medium (M). ~10-15 files, ~40 tool calls. Strategy: Single Session. Wave 5a (parallel with 5.3, 5.4). Plan lane was Operations: Infrastructure (legacy) - corrected to Content: Site Comms per WU-1836 precedent.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: api
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: PackRegistryStore and PackBlobStore are in-memory (InMemoryPackRegistryStore). Data is lost on restart. Problem: Success metric 4 (5 community packs) cannot be met with volatile storage. Solution: Implement VercelBlobPackRegistryStore backed by registry-index.json blob and VercelBlobPackBlobStore using @vercel/blob put(). Update pack-registry-config.ts to select adapter based on BLOB_READ_WRITE_TOKEN env var. Add tarball download route GET /api/registry/packs/:id/versions/:version/tarball.'
acceptance:
  - VercelBlobPackRegistryStore implements PackRegistryStore interface backed by Vercel Blob
  - VercelBlobPackBlobStore implements PackBlobStore interface using @vercel/blob put() with SHA-256 integrity
  - pack-registry-config.ts selects Vercel Blob adapter when BLOB_READ_WRITE_TOKEN is set, falls back to in-memory
  - GET /api/registry/packs/:id/versions/:version/tarball route serves pack tarball from blob store
  - Existing registry API routes work with new adapter (no breaking changes)

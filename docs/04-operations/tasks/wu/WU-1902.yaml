id: WU-1902
title: Add config:set CLI command for safe .lumenflow.config.yaml modification
lane: 'Framework: CLI Enforcement'
type: feature
status: in_progress
priority: P2
created: 2026-02-19
code_paths:
  - packages/@lumenflow/cli/src/config-set.ts
  - packages/@lumenflow/cli/src/config-get.ts
  - packages/@lumenflow/cli/src/__tests__/config-set.test.ts
  - packages/@lumenflow/cli/package.json
  - packages/@lumenflow/core/package.json
  - package.json
  - docs/04-operations/_frameworks/lumenflow/config-set-usage.md
  - apps/docs/src/content/docs/reference/config-commands.mdx
tests:
  manual:
    - Run pnpm config:set --key methodology.testing --value test-after and verify config file
      updated correctly
    - Run pnpm config:set with invalid value and verify rejection with helpful error
  unit:
    - packages/@lumenflow/cli/src/__tests__/config-set.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1902.done
dependencies: []
spec_refs:
  - docs/04-operations/_frameworks/lumenflow/wu-sizing-guide.md
risks: []
notes: Follow the lane:edit pattern in lane-edit.ts which uses withMicroWorktree from
  @lumenflow/core/micro-worktree. Use lodash.set or a minimal dotpath helper for nested key
  navigation. The Zod schema in lumenflow-config-schema.ts provides validation. config:get is
  simpler - just reads and displays via getConfig from @lumenflow/core/config.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'No safe CLI tooling exists for modifying .lumenflow.config.yaml beyond lane:edit
  (which only handles lane definitions). Agents in new projects end up raw-editing the YAML with
  Write/Edit tools, which can break YAML syntax, bypass Zod validation, and get blocked by worktree
  hooks on main. Add a config:set command following the lane:edit pattern: accepts dotpath keys
  (methodology.testing, agents.clients.claude-code.capabilities_map), validates against the Zod
  schema before writing, uses micro-worktree for safe atomic commits.'
acceptance:
  - pnpm config:set --key methodology.testing --value test-after safely updates
    .lumenflow.config.yaml
  - pnpm config:set --key methodology.work_classification.ui.lane_hints --value Experience,Frontend
    appends to array fields
  - Validates new value against Zod schema BEFORE writing - rejects invalid values with clear error
  - Uses micro-worktree isolation pattern from lane:edit - no direct writes to main
  - pnpm config:get --key methodology.testing reads and displays current value
  - Dotpath navigation handles nested objects and arrays correctly
  - 'Unit tests cover: set scalar, set array, get existing, get missing, invalid value rejection,
    nested dotpath'
  - Internal docs in docs/04-operations describing config:set usage and supported dotpaths
  - Starlight reference docs for config:set and config:get commands
claimed_mode: worktree
worktree_path: /home/USER/source/hellmai/os/worktrees/framework-cli-enforcement-wu-1902
claimed_at: 2026-02-19T11:57:20.195Z
baseline_main_sha: 8cbfc7ad561769d7e3ab25fbb3ec1b919cc17263
session_id: 003574c5-7243-4202-b18c-8c442618b172
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-19T11:57:20.201Z

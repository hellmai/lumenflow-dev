id: WU-1466
title: Add subprocess lifecycle e2e for wu create-claim-prep-done path
lane: 'Framework: CLI'
type: feature
status: ready
priority: P1
created: 2026-02-05
code_paths:
  - packages/@lumenflow/cli/e2e/claude-enforcement.test.ts
  - packages/@lumenflow/cli/src/__tests__/wu-lifecycle-integration.test.ts
tests:
  manual:
    - Run lifecycle subprocess e2e and confirm wu:create -> wu:claim -> wu:prep -> wu:done completes
      with expected state transitions.
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-lifecycle-integration.test.ts
  e2e:
    - packages/@lumenflow/cli/e2e/claude-enforcement.test.ts
artifacts:
  - .lumenflow/stamps/WU-1466.done
dependencies: []
initiative: INIT-014
phase: 4
blocked_by:
  - WU-1465
spec_refs:
  - docs/04-operations/plans/INIT-014-rollout-1-launch-readiness-har.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: integration tests simulate lifecycle behavior by writing YAML directly and do
  not execute the full CLI subprocess path for wu:create -> wu:claim -> wu:prep -> wu:done. Problem:
  launch-critical workflow can regress without being caught by end-to-end command execution tests.
  Solution: add a subprocess-driven lifecycle e2e that executes the real commands in sequence and
  asserts expected state transitions and artifacts.'
acceptance:
  - A subprocess e2e test executes wu:create -> wu:claim -> wu:prep -> wu:done end to end
  - The test verifies expected WU status transitions and done stamp output
  - The test runs in CI without relying on manual YAML mutation shortcuts
  - Failure output is actionable for lifecycle regressions

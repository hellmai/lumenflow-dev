id: WU-1368
title: Fix sync:templates --check-drift and add micro-worktree isolation
lane: 'Framework: CLI'
type: feature
status: done
priority: P2
created: 2026-02-03
code_paths:
  - packages/@lumenflow/cli/src/sync-templates.ts
tests:
  manual:
    - Run `pnpm sync:templates --check-drift` on a clean repo; verify no files are modified.
  unit:
    - packages/@lumenflow/cli/src/__tests__/sync-templates.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1368.done
dependencies: []
spec_refs:
  - lumenflow://plans/WU-1368-sync-templates.md
risks: []
notes: 'Adds read-only drift detection and safe micro-worktree isolation for sync:templates.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Two bugs: (1) --check-drift flag syncs files instead of only checking - should be
  read-only. (2) sync:templates writes directly to main checkout - should use micro-worktree
  isolation like wu:create for safe atomic commits.'
acceptance:
  - '--check-drift flag is read-only: compares templates without writing'
  - --check-drift exits 1 if drift detected, exits 0 if in sync
  - sync:templates (without --check-drift) uses micro-worktree isolation
  - Atomic commit created via micro-worktree pattern
  - Unit tests verify --check-drift does not modify filesystem
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-cli-wu-1368
claimed_at: 2026-02-03T09:04:07.347Z
baseline_main_sha: 0c89f4c97a72f98c14569f4abe2dd94d1b3e9cbc
session_id: cfd2aaf9-689c-4acb-b2d3-97e29d6b1ec0
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-03T09:04:07.353Z
locked: true
completed_at: 2026-02-03T09:15:50.643Z

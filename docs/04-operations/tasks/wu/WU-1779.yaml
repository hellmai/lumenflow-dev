id: WU-1779
title: Wire real SandboxSubprocessDispatcher into runtime initialization
lane: 'Framework: Core Lifecycle'
type: bug
status: in_progress
priority: P1
created: 2026-02-17
code_paths:
  - packages/@lumenflow/kernel/src/runtime/kernel-runtime.ts
  - packages/@lumenflow/kernel/src/tool-host/subprocess-dispatcher.ts
tests:
  manual:
    - Execute a manifest-declared subprocess tool through KernelRuntime and verify bwrap-backed
      dispatch succeeds when available
    - or returns explicit structured fallback when unavailable.
  unit:
    - packages/@lumenflow/kernel/src/__tests__/runtime.test.ts
    - packages/@lumenflow/kernel/src/__tests__/tool-host.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1779.done
dependencies: []
initiative: INIT-029
phase: 8
blocked_by:
  - WU-1778
spec_refs:
  - /home/tom/.claude/plans/zesty-jumping-pixel.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
claimed_mode: worktree
assigned_to: tom@hellm.ai
claimed_at: 2026-02-17T17:38:07.103Z
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1779
session_id: fe79e282-49f5-4630-9531-c10adaf6004a
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-17T17:38:07.113Z
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Problem: runtime currently uses a stub subprocess dispatcher that always returns
  SUBPROCESS_NOT_AVAILABLE. Implement and inject a bwrap-backed dispatcher so manifest tools can
  execute end-to-end with graceful fallback when bwrap is unavailable.'
acceptance:
  - SandboxSubprocessDispatcher executes subprocess tools with bwrap sandboxing.
  - initializeKernelRuntime injects real dispatcher when sandbox profile is available.
  - When bwrap is unavailable, runtime returns a structured fallback error instead of silent stub
    behavior.
  - At least one manifest tool executes end-to-end through runtime and emits receipt evidence.
  - Runtime and tool-host tests are updated from stub-expectation to real-dispatch behavior (or
    explicit availability gating).

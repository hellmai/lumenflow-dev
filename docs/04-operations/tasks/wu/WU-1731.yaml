id: WU-1731
title: Kernel built-in tools (fs:read, fs:write, proc:exec) + ESLint boundary rules
lane: 'Framework: Core Lifecycle'
type: feature
status: ready
priority: P1
created: 2026-02-16
code_paths:
  - packages/@lumenflow/kernel/src/tool-host/builtins/
tests:
  manual:
    - pnpm lint passes with boundary rules active
    - pnpm typecheck passes for kernel package
  unit:
    - packages/@lumenflow/kernel/src/__tests__/builtin-tools.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1731.done
dependencies: []
initiative: INIT-029
phase: 2
blocked_by:
  - WU-1729
  - WU-1730
labels:
  - kernel
  - phase-2
  - tools
  - boundary-enforcement
spec_refs:
  - .claude/plans/golden-prancing-cookie.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-029 Phase 2 â€” ToolHost + Evidence. Depends on WU-1729 (ToolHost) and
  WU-1730 (Sandbox). Problem: The kernel needs minimal built-in tools (syscalls) plus ESLint
  boundary rules (Model B two-layer). proc:exec must be internal/admin-only, not exposed to agents.
  Solution: Implement 3 built-in kernel tools: fs:read (in-process, read permission), fs:write
  (subprocess, write permission, scoped to declared_scopes), proc:exec (subprocess, admin
  permission, internal-only not exposed via MCP/CLI tool listing). Model B ESLint: Layer 1 allows
  kernel infra (tool-host, sandbox, event-store). Layer 2 allows packs/**/tool-impl/** (loaded ONLY
  by worker). eslint-plugin-boundaries blocks direct imports of tool-impl/ except from tool-runner
  worker. Reference: eslint-plugin-boundaries (installed). Plan:
  .claude/plans/golden-prancing-cookie.md'
acceptance:
  - 'fs:read tool: in-process ToolCapability with read permission and handler.kind=in-process'
  - 'fs:write tool: subprocess ToolCapability scoped to task declared_scopes with
    handler.kind=subprocess'
  - 'proc:exec tool: subprocess, permission=admin, internal-only (not exposed to agents via MCP/CLI)'
  - proc:exec default-denied by workspace policy; only pack tool-impl uses it inside worker
  - All 3 tools register in ToolRegistry and execute through ToolHost producing receipts
  - 'Model B ESLint: Layer 1 allows kernel/tool-host and kernel/sandbox and kernel/event-store'
  - 'Model B ESLint: Layer 2 allows packs/**/tool-impl/** (loaded only by tool-runner worker)'
  - eslint-plugin-boundaries blocks direct tool-impl imports except from tool-runner worker
  - Packs importing fs directly outside tool-impl get a lint error

id: WU-1449
title: Fix flaky orchestrate-initiative-wu1251 test timeout
lane: 'Framework: Initiatives'
type: bug
status: done
priority: P3
created: 2026-02-05
code_paths:
  - packages/@lumenflow/initiatives/__tests__/orchestrate-initiative-wu1251.test.ts
tests:
  manual:
    - 'Run: pnpm test --filter @lumenflow/initiatives and confirm orchestrate tests pass'
    - 'Run: pnpm gates and confirm no orchestrate-related timeouts'
  unit:
    - packages/@lumenflow/initiatives/__tests__/orchestrate-initiative-wu1251.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1449.done
dependencies: []
risks: []
notes: 'Fix: Replace await import() inside each test with static import at top of file. See Vitest
  best practices.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Test passes on main but times out (5000ms) intermittently in worktree
  environments during wu:done. WU-1437 investigated but misdiagnosed as spec:linter issue. Root
  cause: Test uses dynamic imports (await import) inside each test case rather than static imports
  at module level. This causes module loading overhead per test and resource contention sensitivity
  in worktrees. Solution: Convert to static imports or use beforeAll. Refs:
  vitest.dev/guide/mocking.html, github.com/vitest-dev/vitest/issues/7361'
acceptance:
  - Test uses static imports or beforeAll pattern instead of per-test dynamic imports
  - Test passes consistently in both main and worktree environments
  - No timeout failures during wu:done in worktree (run 5x to verify)
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-initiatives-wu-1449
claimed_at: 2026-02-05T13:31:06.943Z
baseline_main_sha: beb77eba00e7a1f1e991318396eb95d72d1f0779
session_id: 91f16e72-b8c0-44f4-a23e-efde4ff2230d
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-05T13:31:06.947Z
locked: true
completed_at: 2026-02-05T13:35:18.633Z

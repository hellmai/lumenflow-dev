id: WU-1296
title: Make release flow compatible with trunk protections (no direct push to main)
lane: 'Framework: CLI'
type: refactor
status: done
priority: P1
created: 2026-02-01
code_paths:
  - packages/@lumenflow/cli/src/release.ts
  - .husky/hooks/pre-push.mjs
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/cli/src/__tests__/release.test.ts
    - packages/@lumenflow/cli/__tests__/pre-push-hook.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1296.done
dependencies: []
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: pnpm release uses micro-worktree to merge and push directly to origin/main,
  but pre-push hooks block direct main pushes. Problem: release retries fail even when build is
  green because trunk protections require wu:done pathway. Solution: adjust release flow to use the
  approved merge/push path (or a release-specific lane flow) so releases can succeed without
  force-bypass.'
acceptance:
  - Release flow succeeds without LUMENFLOW_FORCE when trunk protections are enabled
  - Release still runs build, tags, and publish steps
  - Release tests cover the updated push/merge behavior
claimed_mode: worktree
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-01T11:01:16.706Z
locked: true
completed_at: 2026-02-01T11:28:45.404Z

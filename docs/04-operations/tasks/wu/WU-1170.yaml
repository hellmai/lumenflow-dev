id: WU-1170
title: 'Universal Agent Safety: Migrate Claude hooks to Husky/Scripts'
lane: 'Framework: Core'
type: feature
status: done
priority: P2
created: 2026-01-28
code_paths:
  - scripts/hooks/scan-secrets.sh
  - scripts/hooks/check-lockfile.sh
  - scripts/hooks/validate-paths.sh
  - scripts/hooks/validate-worktree-discipline.sh
  - scripts/safe-git
  - .husky/pre-commit
  - LUMENFLOW.md
  - docs/04-operations/_frameworks/lumenflow/agent/onboarding/agent-safety-card.md
  - apps/docs/src/content/docs/guides/agent-onboarding.mdx
  - apps/docs/src/content/docs/guides/ai-agents.mdx
tests:
  manual:
    - Attempt to commit file with mock secret - BLOCKED
    - Attempt to commit file with absolute path - BLOCKED
    - Modify package.json without lockfile - BLOCKED
    - Commit to main with active worktree - BLOCKED
  unit:
    - packages/@lumenflow/cli/src/__tests__/safe-git.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1170.done
dependencies: []
spec_refs:
  - lumenflow://plans/WU-1170-safety-alignment.md
risks: []
notes: |
  Additional verified behaviors:
  - Secret scanning blocks commits with AWS/GitHub/OpenAI keys
  - Lockfile sync blocks dependency changes without pnpm-lock.yaml update
  - Worktree discipline blocks main commits when worktrees exist
  - Audit logging writes to .lumenflow/safety-blocks.log
  - Internal docs updated: LUMENFLOW.md documents safety hooks
  - Agent safety card updated with new hooks information
  - Starlight public docs updated: agent-onboarding.mdx, ai-agents.mdx
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Align all agents (Windsurf, Cursor, etc.) with LumenFlow safety standards by migrating
  Claude-specific protections. 1) Create 'scripts/safe-git' wrapper to block 'worktree remove'. 2)
  Migrate 'validate-worktree-path' to Husky 'pre-commit' hook.
acceptance:
  - Manual 'git worktree remove' via safe-git wrapper is blocked or warned
  - Generic 'git commit' with absolute paths is blocked by Husky hook
  - Safety mechanisms work for non-Claude agents
claimed_mode: worktree
worktree_path: /home/USER/source/hellmai/os/worktrees/framework-core-wu-1170
claimed_at: 2026-01-28T22:50:06.787Z
baseline_main_sha: af2327e2a26573a93c47c6c5af204105270506cf
session_id: 9866840b-b845-4343-a7f9-913a812401a1
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-28T22:50:06.797Z
locked: true
completed_at: 2026-01-29T11:57:37.757Z

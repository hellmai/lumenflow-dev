id: WU-1608
title: Fix wu:brief LOG_PREFIX leak and tautological tests
lane: 'Framework: CLI Orchestration'
type: bug
status: ready
priority: P1
created: 2026-02-12
code_paths:
  - packages/@lumenflow/cli/src/wu-spawn.ts
  - packages/@lumenflow/cli/src/wu-brief.ts
  - packages/@lumenflow/cli/__tests__/wu-spawn.test.ts
  - packages/@lumenflow/mcp/src/tools.ts
tests:
  manual:
    - Run pnpm wu:brief --id WU-1601 and verify all log lines show [wu:brief] prefix
  unit:
    - packages/@lumenflow/cli/__tests__/wu-spawn.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1608.done
dependencies: []
initiative: INIT-024
phase: 2
risks: []
notes: Fix HIGH issues from WU-1603 code review. Must use TDD — write failing tests for prefix and equivalence BEFORE fixing implementation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'WU-1603 introduced wu:brief but has two HIGH issues: (1) hardcoded LOG_PREFIX=[wu:spawn] leaks into wu:brief output, (2) equivalence tests are tautological — call same function twice instead of testing actual code paths. MEDIUM: no wu-brief.test.ts, MCP uses WU_SPAWN_ERROR for wu:brief, DRY violation in MCP tools.'
acceptance:
  - wu:brief output uses [wu:brief] prefix throughout, not [wu:spawn]
  - Equivalence tests invoke runBriefLogic with deprecated:true and deprecated:false and compare prompt output
  - Behavioral test verifies deprecated:true emits warning and deprecated:false does not
  - MCP wu:brief tool uses its own error code, not WU_SPAWN_ERROR

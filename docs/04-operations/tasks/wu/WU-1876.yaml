id: WU-1876
title: Evidence export endpoint with CSV and JSON format support
lane: 'Content: Site Comms'
type: feature
status: ready
priority: P2
created: 2026-02-18
code_paths:
  - apps/web/app/api/tasks/[taskId]/evidence/export/route.ts
  - apps/web/src/components/evidence-viewer.tsx
tests:
  manual:
    - Verify CSV export downloads valid CSV with correct columns
    - Verify JSON export returns well-formed array
  unit:
    - apps/web/app/api/tasks/[taskId]/evidence/__tests__/export.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1876.done
dependencies: []
initiative: INIT-031
phase: 6
blocked_by:
  - WU-1872
spec_refs:
  - .claude/plans/partitioned-sprouting-nest.md
risks: []
notes: 'Sizing: Simple (S). ~5-8 files, ~20 tool calls. Strategy: Single Session. Wave 6b (after 5.2). Small endpoint + button addition.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: api
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Evidence viewer (WU-1872) shows tool traces in the browser. Problem: Users need to export evidence for compliance audits and offline analysis. Solution: Add GET /api/tasks/:taskId/evidence/export?format=csv|json endpoint. CSV columns: receipt_id, tool_name, started_at, finished_at, duration_ms, result, scope_requested_summary, scope_enforced_summary. Add Export button on evidence viewer page.'
acceptance:
  - GET /api/tasks/:taskId/evidence/export?format=json returns JSON array of trace records
  - GET /api/tasks/:taskId/evidence/export?format=csv returns CSV with correct headers and Content-Disposition
  - 'CSV columns: receipt_id, tool_name, started_at, finished_at, duration_ms, result, scope_requested_summary, scope_enforced_summary'
  - Export button on evidence viewer page triggers download

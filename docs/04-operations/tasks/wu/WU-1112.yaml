id: WU-1112
title: 'INIT-003 Phase 6: Migrate remaining Tier 1 tools'
lane: 'Framework: CLI'
type: feature
status: done
priority: P3
created: 2026-01-25
code_paths:
  - packages/@lumenflow/cli/src/deps-add.ts
  - packages/@lumenflow/cli/src/deps-remove.ts
  - packages/@lumenflow/cli/src/lumenflow-upgrade.ts
  - packages/@lumenflow/cli/src/session-coordinator.ts
  - packages/@lumenflow/cli/src/rotate-progress.ts
  - packages/@lumenflow/cli/src/trace-gen.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/cli/src/__tests__/deps-operations.test.ts
    - packages/@lumenflow/cli/src/__tests__/lumenflow-upgrade.test.ts
    - packages/@lumenflow/cli/src/__tests__/session-coordinator.test.ts
    - packages/@lumenflow/cli/src/__tests__/rotate-progress.test.ts
    - packages/@lumenflow/cli/src/__tests__/trace-gen.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1112.done
dependencies: []
initiative: INIT-003
phase: 6
blocked_by:
  - WU-1101
  - WU-1104
spec_refs:
  - lumenflow://plans/unified-rolling-music.md
risks:
  - 'lumenflow:upgrade workflow gap: updates package.json on main but pnpm install blocked by
    worktree discipline'
  - 'lumenflow:upgrade missing packages: only checks 4 of 7 @lumenflow/* packages'
notes: |-
  KNOWN ISSUE 1: lumenflow:upgrade modifies package.json on main via micro-worktree,
  but subsequent pnpm install is blocked by worktree hooks.

  SOLUTION: Use worktree pattern consistent with wu:* tooling:
  1. Create temp upgrade worktree (like wu:claim creates worktrees)
  2. Update package.json in worktree
  3. Run pnpm install in worktree (no hooks blocking - worktrees allow this)
  4. Commit package.json + pnpm-lock.yaml
  5. Merge to main via micro-worktree pattern (like wu:done)

  This maintains worktree discipline consistency across all tooling.

  KNOWN ISSUE 2: ExampleApp lumenflow-upgrade.mjs LUMENFLOW_PACKAGES array (line 34-39)
  only includes 4 packages but there are 7 @lumenflow/* packages:
  - Missing: @lumenflow/agent, @lumenflow/cli, @lumenflow/initiatives
  - Has: @lumenflow/core, @lumenflow/memory, @lumenflow/metrics, @lumenflow/shims

  SOLUTION: Migration must include all 7 packages in LUMENFLOW_PACKAGES constant.
  Released (2026-01-25): Releasing to work on WU-1109 as instructed by user
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Migrate deps-add, deps-remove, session-coordinator, rotate-progress, lumenflow-upgrade,
  trace-gen from ExampleApp. These are the remaining generic tools. Some have existing tests.
acceptance:
  - deps-add.ts and deps-remove.ts exist with tests
  - session-coordinator.ts exists
  - rotate-progress.ts exists
  - lumenflow-upgrade.ts exists with tests
  - lumenflow-upgrade uses worktree pattern (install runs in worktree, not main)
  - lumenflow-upgrade checks all 7 @lumenflow/* packages (not just 4)
  - trace-gen.ts exists
  - All bin entries added
  - '>80% coverage on migrated code'
claimed_mode: worktree
baseline_main_sha: 70ed93111831940577493b5f599e09984acd0c68
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-25T23:42:41.364Z
locked: true
completed_at: 2026-01-26T00:06:00.869Z

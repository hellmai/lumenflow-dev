id: WU-1738
title: MCP surface rewrite — calls KernelRuntime directly, not CLI
lane: 'Framework: MCP'
type: feature
status: done
priority: P1
created: 2026-02-16
code_paths:
  - packages/@lumenflow/surfaces/mcp/
tests:
  manual:
    - MCP server starts and responds to tool calls
  unit:
    - packages/@lumenflow/surfaces/mcp/__tests__/server.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1738.done
dependencies: []
initiative: INIT-029
phase: 4
blocked_by:
  - WU-1735
labels:
  - surfaces
  - phase-4
  - mcp
spec_refs:
  - .claude/plans/golden-prancing-cookie.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: api
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-029 Phase 4 — Surfaces + Daemon. Depends on WU-1735 (KernelRuntime).
  Problem: Current MCP server shells out to CLI for write operations and imports core for reads.
  This creates a circular chain (MCP -> CLI -> core -> tools). Solution: Rewrite MCP surface to call
  KernelRuntime directly for both use-cases (create/claim/complete/inspect) and tool execution.
  Route based on name prefix: use-case names call runtime methods, tool names call
  runtime.executeTool(). Eliminates the MCP -> CLI -> core circular chain. Reference: cli-runner.ts
  (current MCP->CLI bridge to replace). Plan: .claude/plans/golden-prancing-cookie.md'
acceptance:
  - MCP server calls KernelRuntime for all operations — no shell-out to CLI
  - MCP use-case tools (task:create, task:claim, etc.) route to runtime methods
  - MCP domain tools route to runtime.executeTool()
  - MCP and CLI produce identical receipts for identical operations
  - Zero imports from @lumenflow/cli in MCP surface package
  - Zero execFileAsync/spawn calls to CLI binary from MCP
  - MCP tool schemas generated from Zod via JSON Schema export
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-mcp-wu-1738
claimed_at: 2026-02-17T00:09:19.167Z
baseline_main_sha: 3fe0fc0a8e668fa8f1ae2225e527fa1445433a36
session_id: ea186b32-dfe7-4e05-8385-7c7d28a6a11f
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-17T00:09:19.174Z
locked: true
completed_at: 2026-02-17T00:13:24.016Z
completed: 2026-02-17

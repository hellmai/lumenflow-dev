id: WU-1883
title: Extract ENOENT/stat helpers and add trace-failure telemetry to ToolHost
lane: 'Framework: Core Lifecycle'
type: refactor
status: in_progress
priority: P3
created: 2026-02-19
code_paths:
  - packages/@lumenflow/kernel/src/evidence/evidence-store.ts
  - packages/@lumenflow/kernel/src/tool-host/tool-host.ts
tests:
  manual:
    - Verify onTraceError callback fires when trace recording fails
  unit:
    - packages/@lumenflow/kernel/src/__tests__/evidence-store.test.ts
    - packages/@lumenflow/kernel/src/__tests__/tool-host.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1883.done
dependencies: []
initiative: INIT-030
risks: []
notes: 'Sizing: Simple (4-5 files, ~30 tool calls, <30% context). DRY improvement + observability.
  Found during INIT-030 Phase 5 code review.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: The ENOENT check pattern (catch + nodeError.code === ENOENT) appears 8+ times in
  evidence-store.ts. Extract readFileOrEmpty() and statOrNull() helpers. Additionally, the 5 silent
  catch blocks in tool-host.ts (WU-1867) have no telemetry â€” add optional onTraceError callback to
  ToolHostOptions so trace failures are observable.
acceptance:
  - readFileOrEmpty() and statOrNull() helpers extract repeated ENOENT boilerplate
  - All 8+ ENOENT catch blocks in evidence-store.ts replaced with helper calls
  - ToolHostOptions gains optional onTraceError callback
  - All 5 silent catch blocks in tool-host.ts invoke onTraceError when provided
  - Existing tests pass without modification (backward compatible)
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1883
claimed_at: 2026-02-19T09:21:46.608Z
baseline_main_sha: 8ef121dd38adb04ee011d1a54d7eb2a0808fb45a
session_id: a050e0a4-6ffa-452a-a62b-396ddc6e0a85
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-19T09:21:46.615Z

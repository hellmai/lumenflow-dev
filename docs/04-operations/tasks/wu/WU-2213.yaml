id: WU-2213
title: Duplicate-ID detector and repair command
lane: 'Framework: CLI WU Commands'
type: feature
status: in_progress
priority: P3
created: 2026-02-26
code_paths:
  - packages/@lumenflow/core/src/wu-repair-core.ts
  - packages/@lumenflow/cli/src/wu-repair.ts
tests:
  manual:
    - Run on repo with known duplicate ID, verify detection and repair
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-repair-core.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2213.done
dependencies: []
spec_refs:
  - memory/distributed-state-audit.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
sizing_estimate:
  estimated_files: 5
  estimated_tool_calls: 35
  strategy: single-session
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Add detection and controlled repair for repos already affected by WU ID collisions.
  New mode: wu:repair --duplicate-ids. Detects collisions across YAML, stamps, and event stream.
  Dry-run first, explicit apply mode. Emits mapping report with ID remapping and touched files.'
acceptance:
  - wu:repair --duplicate-ids detects ID collisions across YAML, stamps, events
  - Dry-run mode is default and non-mutating
  - --apply mode renames colliding WUs with new IDs and updates all references
  - Mapping report emitted showing ID remapping
  - Preserves referential integrity (blocked-by, events, stamps all updated)
claimed_mode: worktree
worktree_path: /home/USER/source/hellmai/lumenflow-dev/worktrees/framework-cli-wu-commands-wu-2213
claimed_at: 2026-02-26T14:57:14.974Z
baseline_main_sha: da56b17103e2abaefb473a77b1af72365a341a90
session_id: 66591fd5-94fd-4d7c-bb5a-080d7ded0d74
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-26T14:57:14.981Z

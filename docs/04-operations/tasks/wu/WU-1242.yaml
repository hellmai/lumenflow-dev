id: WU-1242
title: Add --watch patrol mode for continuous spawn monitoring
lane: 'Framework: CLI'
type: feature
status: done
priority: P1
created: 2026-01-30
code_paths:
  - packages/@lumenflow/cli/src/orchestrate-monitor.ts
  - packages/@lumenflow/core/src/patrol-loop.ts
  - packages/@lumenflow/core/src/index.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/cli/__tests__/orchestrate-monitor-watch.test.ts
    - packages/@lumenflow/core/src/__tests__/patrol-loop.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1242.done
dependencies:
  - WU-1241
initiative: INIT-008
phase: 2
spec_refs:
  - internal
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "Context: WU-1241 wires orchestrate:monitor to the spawn-monitor APIs for one-shot
  status checks. However, supervision requires continuous monitoring - the 'Witness patrol' pattern
  from Gas Town. Problem: Without continuous monitoring, stuck spawns and zombie locks accumulate
  between manual checks. Human operators must remember to run orchestrate:monitor periodically.
  Solution: Add --watch flag to orchestrate:monitor that runs a continuous patrol loop: (1) Check
  spawn status at configurable interval (default 5min), (2) Detect stuck spawns and zombie locks,
  (3) Take recovery actions with exponential backoff, (4) Signal parent agent or escalate to human,
  (5) Log all actions for audit trail. The patrol loop is the supervisor daemon that keeps the spawn
  fleet healthy."
acceptance:
  - orchestrate:monitor --watch enters continuous patrol mode
  - Patrol interval configurable (default 5min, --interval flag)
  - Exponential backoff on repeated failures (max 1hr)
  - Graceful shutdown on SIGINT/SIGTERM
  - Status summary printed at each patrol cycle
  - Unit tests verify watch mode/backoff logic
  - Documentation updated
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-cli-wu-1242
claimed_at: 2026-01-31T11:46:38.316Z
baseline_main_sha: d1718b2235e452eb8bcac25801348da958aa3f61
session_id: b20dde8e-5e0f-4c81-a631-a2d2e5bb7a8e
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-31T11:46:38.324Z
locked: true
completed_at: 2026-01-31T12:06:19.969Z

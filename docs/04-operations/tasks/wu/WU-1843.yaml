id: WU-1843
title: 'Harden pack-loader import boundary: deny bare specifiers and fix prefix match'
lane: 'Framework: Core Lifecycle'
type: bug
status: ready
priority: P0
created: 2026-02-18
code_paths:
  - packages/@lumenflow/kernel/src/pack/pack-loader.ts
tests:
  manual:
    - Verify software-delivery pack still loads successfully after boundary tightening
  unit:
    - packages/@lumenflow/kernel/src/__tests__/pack-loader.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1843.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Pack-loader import boundary validation has three security gaps found in INIT-030 code review: (1) Bare npm specifiers (e.g. lodash, axios) silently pass all if-checks in validatePackImportBoundaries without throwing — a pack could import arbitrary npm packages bypassing sandbox isolation. (2) The @lumenflow/kernel check uses startsWith which would also match @lumenflow/kernel-utils or similar. Should be exact match or check for / or end-of-string. (3) IMPORT_SPECIFIER_PATTERNS uses RegExp /g flag on module-level const patterns — shared lastIndex state is a known JavaScript footgun that can skip matches under concurrent use. Should use String.prototype.matchAll or create fresh RegExp per call.'
acceptance:
  - Bare npm specifiers throw PackBoundaryViolation error
  - startsWith check replaced with exact package name match
  - RegExp /g patterns replaced with matchAll or fresh-per-call instances
  - Existing pack-loader.test.ts updated with bare specifier rejection test and prefix-match boundary test

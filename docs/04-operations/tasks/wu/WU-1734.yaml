id: WU-1734
title: Software delivery pack — Git tools + worktree + lane locks + delegation
lane: 'Framework: Core State Recovery'
type: feature
status: ready
priority: P1
created: 2026-02-16
code_paths:
  - packages/@lumenflow/packs/software-delivery/tools/
  - packages/@lumenflow/packs/software-delivery/tool-impl/
tests:
  manual:
    - pnpm typecheck passes
  unit:
    - packages/@lumenflow/packs/software-delivery/__tests__/git-tools.test.ts
    - packages/@lumenflow/packs/software-delivery/__tests__/lane-lock.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1734.done
dependencies: []
initiative: INIT-029
phase: 3
blocked_by:
  - WU-1732
  - WU-1733
labels:
  - packs
  - phase-3
  - software-delivery
  - git
spec_refs:
  - .claude/plans/golden-prancing-cookie.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-029 Phase 3 — Policies + Packs. Depends on WU-1732 (PolicyEngine) and
  WU-1733 (SW delivery extensions). Problem: Current git/worktree/delegation tools are spread across
  core as standalone modules. They need to become ToolCapability descriptors plus tool-impl
  implementations registered through the pack system. Solution: Capability descriptors in the tools
  directory export ToolCapability with handler.kind=subprocess and entry string refs (no side-effect
  imports). Implementations in the tool-impl directory contain actual child_process and simple-git
  calls (loaded only by tool-runner worker). Git tools, lane lock, delegation tools, worktree
  lifecycle. All tool-impl files loaded only by worker inside sandbox. Reference: git-adapter.ts,
  lane-lock.ts, delegation-registry-store.ts. Plan: .claude/plans/golden-prancing-cookie.md'
acceptance:
  - Git tool descriptors in packs tools directory with handler.kind=subprocess and entry strings
  - Git tool implementations in packs tool-impl directory with actual child_process and simple-git
    calls
  - tool-impl files loaded ONLY by tool-runner worker (ESLint boundary enforced)
  - All git tools produce receipts when executed through ToolHost
  - 'Lane lock tool: descriptor in tools dir plus implementation in tool-impl with atomic
    acquire/release'
  - 'Delegation tools: descriptor plus implementation with lineage tracking'
  - 'Worktree lifecycle tools (create, remove, list): descriptor plus implementation'
  - git:commit execution produces receipt with artifacts_written field
  - Lane lock acquires and releases correctly with staleness detection
  - No side-effect imports (fs, child_process) in tools directory descriptor files

id: WU-1063
title: Fix wu:edit dropping spec_refs
lane: 'Framework: Core'
type: bug
status: done
priority: P1
created: 2026-01-22
code_paths:
  - packages/@lumenflow/core/src/__tests__/wu-schema-normalization.test.ts
  - packages/@lumenflow/core/src/wu-schema-normalization.ts
tests:
  manual:
    - Run wu:edit on a feature WU with spec_refs; spec_refs remains intact
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-schema-normalization.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1063.done
dependencies: []
risks: []
notes: Completed per acceptance criteria.
requires_review: false
claimed_mode: worktree
assigned_to: tom@hellm.ai
claimed_at: 2026-01-27T15:59:16.800Z
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-wu-1063
session_id: 613082ad-2491-4480-9444-a0e551da9496
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-27T15:59:16.805Z
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: >-
  Context: wu:edit normalizes WU YAML before validation.

  Problem: normalizeWUSchema currently deletes spec_refs, so any wu:edit run strips plan links and
  triggers missing spec_refs warnings.

  Solution: Preserve spec_refs during normalization and add coverage to prevent regression.
acceptance:
  - normalizeWUSchema preserves spec_refs (no deletion)
  - wu:edit keeps existing spec_refs after editing any other field
  - wu:validate no longer warns about missing spec_refs after wu:edit on feature WUs
locked: true
completed_at: 2026-01-27T16:09:30.658Z

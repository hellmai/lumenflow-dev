id: WU-1900
title: Wire work classifier into wu:brief generation for skills, test guidance, and constraints
lane: 'Framework: CLI WU Commands'
type: bug
status: ready
priority: P1
created: 2026-02-19
code_paths:
  - packages/@lumenflow/core/src/wu-spawn-skills.ts
  - packages/@lumenflow/core/src/wu-spawn.ts
  - packages/@lumenflow/cli/src/wu-spawn-prompt-builders.ts
  - packages/@lumenflow/core/src/__tests__/wu-spawn-skills.test.ts
  - packages/@lumenflow/core/src/__tests__/wu-spawn.test.ts
  - docs/04-operations/_frameworks/lumenflow/**
tests:
  manual:
    - Run pnpm wu:brief on a WU with CSS code_paths and verify design context section appears
    - Run pnpm wu:brief on a backend WU and verify no design context section
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-spawn-skills.test.ts
    - packages/@lumenflow/core/src/__tests__/wu-spawn.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1900.done
dependencies: []
blocked_by:
  - WU-1898
  - WU-1899
risks: []
notes: 'Depends on WU-1898 (template conditions) and WU-1899 (classifier). The capabilities_map config goes in agents.clients.<client>.capabilities_map in .lumenflow.config.yaml. Default mapping for claude-code: ui-design-awareness -> frontend-design, component-reuse-check -> library-first.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Integrate the work classifier from WU-1899 into brief/spawn generation to fix 5 bugs: (1) SMOKE_TEST_TYPES unreachable via normal WU types, (2) hardcoded lane-only skill suggestions, (3) constraints always enforcing TDD regardless of methodology, (4) missing design context section for UI work, (5) no codebase exploration guidance for UI work. Uses classifier capabilities for vendor-agnostic skill mapping via client config.'
acceptance:
  - generateSkillsSelectionSection uses classifyWork output to suggest skills via capability-to-skill mapping from client config
  - generatePolicyBasedTestGuidance checks classifier output - a bug type WU with CSS code_paths gets smoke-test guidance not full TDD
  - 'generateConstraints constraint 1 (TDD CHECKPOINT) is conditional: omitted when work classified as UI or methodology is none'
  - New generateDesignContextSection added to brief output for UI-classified work with pattern check guidance and viewport verification
  - Design context section is vendor-agnostic - no /skill syntax, client skill mapping happens in skills section
  - Existing non-UI brief generation unchanged - regression tests pass
  - 'Integration test: bug WU with CSS code_paths gets frontend-design skill suggestion, smoke-test guidance, design context section'
  - Internal docs updated describing capability-to-skill mapping and design context section
  - Starlight docs updated for new brief sections and client capabilities_map config

id: WU-1502
title: Add Bash PostToolUse dirty-main warning hook
lane: 'Framework: CLI'
type: feature
status: ready
priority: P2
created: 2026-02-07
code_paths:
  - .claude/settings.json
  - .claude/hooks/block-bash-file-commands.sh
  - packages/@lumenflow/cli/src/hooks/enforcement-generator.ts
  - packages/@lumenflow/cli/src/init.ts
tests:
  manual:
    - Run a Bash command that writes files on main and verify warning includes modified paths
  unit:
    - packages/@lumenflow/cli/src/__tests__/hooks/enforcement.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1502.done
dependencies: []
spec_refs:
  - packages/@lumenflow/cli/src/hooks/enforcement-generator.ts
risks: []
notes: 'Implements Claude finding #2: catch script-generated writes that bypass Write/Edit hooks.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Write/Edit hooks do not see files modified indirectly by Bash-invoked scripts. Problem: generated file writes on main can bypass tool-level enforcement and remain orphaned. Solution: add a lightweight PostToolUse Bash hook that detects file modifications on main and emits a high-signal warning with changed paths.'
acceptance:
  - PostToolUse hook runs for Bash tool calls and checks for working tree modifications on main
  - Warning output lists modified files and guidance to create/claim a WU or discard changes
  - Hook is non-blocking and performance overhead remains minimal

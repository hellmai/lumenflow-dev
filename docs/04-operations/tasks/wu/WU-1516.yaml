id: WU-1516
title: Add lifecycle regression harness for create/done/delete state consistency
lane: 'Framework: Core Lifecycle'
type: refactor
status: ready
priority: P2
created: 2026-02-07
code_paths:
  - packages/@lumenflow/cli/src/__tests__/state-doctor.test.ts
  - packages/@lumenflow/cli/src/__tests__/wu-delete.test.ts
  - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
  - packages/@lumenflow/cli/src/state-doctor.ts
  - packages/@lumenflow/cli/src/wu-delete.ts
  - packages/@lumenflow/cli/src/wu-done.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/cli/src/__tests__/state-doctor.test.ts
    - packages/@lumenflow/cli/src/__tests__/wu-delete.test.ts
    - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1516.done
dependencies: []
initiative: INIT-019
phase: 3
spec_refs:
  - docs/04-operations/tasks/initiatives/INIT-019.yaml
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: lifecycle defects have escaped repeatedly across wu:create, wu:done, wu:delete, and state:doctor interactions. Problem: targeted unit tests miss cross-command consistency regressions. Solution: add a deterministic lifecycle regression harness that exercises create→claim→done/delete consistency invariants and verifies projections/state-store remain clean.'
acceptance:
  - Test harness reproduces end-to-end lifecycle transitions and asserts clean status/backlog/state projections
  - Harness asserts no Broken Event remains for deleted WUs
  - Failures point directly to violating command stage (create/claim/done/delete/doctor) for fast diagnosis

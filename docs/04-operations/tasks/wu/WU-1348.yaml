id: WU-1348
title: Avoid main checkout resets in micro-worktree push retry
lane: 'Framework: Core'
type: bug
status: ready
priority: P2
created: 2026-02-02
code_paths:
  - packages/@lumenflow/core/src/micro-worktree.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/core/src/__tests__/micro-worktree.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1348.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: micro-worktree push retry resets local main on non-fast-forward. Problem: hard reset mutates user main checkout and can discard local changes or cause file flash, violating micro-worktree isolation. Solution: remove main checkout reset from retry; retry should be fully isolated (push-only) or fail with actionable error without touching main.'
acceptance:
  - Retry logic never hard-resets the main checkout on push failure
  - Main checkout files are untouched during retry attempts
  - Retry path uses micro-worktree isolation end-to-end or fails cleanly with retry guidance
  - Unit tests updated to reflect new retry behavior

id: WU-1797
title: 'Phase 3 pack workflow: expose WU YAML lifecycle as runtime-managed pack tools'
lane: 'Framework: Core Lifecycle'
type: feature
status: done
priority: P1
created: 2026-02-18
code_paths:
  - packages/@lumenflow/mcp/src/runtime-tool-resolver.ts
  - packages/@lumenflow/mcp/src/tools/runtime-task-tools.ts
  - packages/@lumenflow/kernel/src/runtime/kernel-runtime.ts
tests:
  manual:
    - Execute a runtime-managed WU metadata operation and verify
      tool_call_started/tool_call_finished receipts include scoped capability metadata.
    - Resolver returns in-process handler for registered tool and subprocess handler for
      unregistered tool
  unit:
    - packages/@lumenflow/packs/software-delivery/__tests__/extensions.test.ts
    - packages/@lumenflow/kernel/src/__tests__/runtime.test.ts
    - packages/@lumenflow/mcp/src/__tests__/runtime-task-tools.test.ts
    - packages/@lumenflow/mcp/src/__tests__/runtime-tool-resolver.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1797.done
dependencies: []
initiative: INIT-030
phase: 3
blocked_by:
  - WU-1796
spec_refs:
  - /home/tom/.claude/plans/zesty-jumping-pixel.md
risks: []
notes: 'Rewritten to adaptive plan A2. Spec ref: adaptive-finding-adleman.md. Key:
  toolCapabilityResolver injection at kernel-runtime.ts:116.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Phase 3 uses the pack tool system where tools declared in manifest are loaded
  by PackLoader and dispatched via ToolHost. Problem: the default toolCapabilityResolver uses
  subprocess handlers constrained by the import boundary (node: + @lumenflow/kernel only), but tool
  handlers need access to @lumenflow/core, @lumenflow/memory, etc. Solution: create a custom
  RuntimeToolCapabilityResolver in @lumenflow/mcp that provides in-process handlers delegating to
  existing CLI/core logic, injected via the toolCapabilityResolver option on
  initializeKernelRuntime().'
acceptance:
  - New runtime-tool-resolver.ts module in packages/@lumenflow/mcp/src/ exports
    packToolCapabilityResolver
  - packToolCapabilityResolver returns in-process handlers for registered tools and falls back to
    defaultRuntimeToolCapabilityResolver for unregistered tools
  - getRuntimeForWorkspace() in runtime-task-tools.ts passes custom resolver to
    initializeKernelRuntime()
  - Runtime initializes successfully with custom resolver wired in
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1797
claimed_at: 2026-02-18T09:03:18.125Z
baseline_main_sha: 7b789ef26facb916452ed4c98b9c9aebf7be5b66
session_id: 29cc0af1-b3c8-419b-b8cd-85ab8b21d9d5
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-18T09:03:18.132Z
locked: true
completed_at: 2026-02-18T09:11:46.395Z
completed: 2026-02-18

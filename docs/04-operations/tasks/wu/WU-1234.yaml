id: WU-1234
title: Add mem:context command for context injection at spawn
lane: 'Framework: Memory'
type: feature
status: done
priority: P1
created: 2026-01-30
code_paths:
  - packages/@lumenflow/memory/src/mem-context-core.ts
  - packages/@lumenflow/cli/src/mem-context.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/memory/__tests__/mem-context-core.test.ts
    - packages/@lumenflow/cli/__tests__/mem-context.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1234.done
dependencies: []
initiative: INIT-008
phase: 1
spec_refs:
  - internal
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: LumenFlow memory has storage and lifecycle but no way to inject relevant
  context at session start. Supermemory and similar tools automatically inject relevant memories
  when a new agent session begins. Problem: When wu:spawn creates a new agent session, it has no
  access to relevant project knowledge, recent summaries, or WU-specific context from the memory
  layer. Agents start cold without accumulated knowledge. Solution: Add mem:context command that
  produces a deterministic, formatted context injection block containing: (1) Project profile items
  (top N project-lifecycle memories), (2) Recent summaries relevant to the target WU/lane, (3)
  Current WU ready nodes and latest checkpoint, (4) Open discoveries for the WU. Output is
  structured text suitable for embedding into wu:spawn. Selection is deterministic (filter by
  lifecycle, WU, tags, recency). No LLM calls inside LumenFlow (vendor-agnostic).'
acceptance:
  - mem:context --wu WU-XXXX outputs formatted context block
  - 'Context block includes: project profile, relevant summaries, WU context'
  - 'Selection is deterministic: filter by lifecycle=project, wu_id match, recency'
  - Output format is structured markdown with clear sections
  - Max context size is configurable (default 4KB)
  - 'Graceful degradation: empty block if no memories match'
  - Output is suitable for embedding into wu:spawn prompts (integration tracked in WU-1240)
  - Unit tests cover selection logic and output formatting
  - Documentation updated in memory package README
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-memory-wu-1234
claimed_at: 2026-01-31T10:27:42.804Z
baseline_main_sha: f382802e0662142d75957d935cd65240997e5d3b
session_id: 355e1c8c-e7de-4a14-a421-c11ad59b7080
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-31T10:27:42.809Z
locked: true
completed_at: 2026-01-31T10:47:46.882Z

id: WU-1683
title: Add first-class plan field to WU schema for plan-to-WU linking
lane: 'Framework: CLI WU Commands'
type: feature
status: in_progress
priority: P2
created: 2026-02-15
code_paths:
  - packages/@lumenflow/core/src/wu-schema.ts
  - packages/@lumenflow/core/src/context/wu-state-reader.ts
  - packages/@lumenflow/core/src/validation/types.ts
  - packages/@lumenflow/cli/src/wu-create.ts
  - packages/@lumenflow/cli/src/wu-create-content.ts
  - packages/@lumenflow/cli/src/wu-create-validation.ts
  - packages/@lumenflow/cli/src/wu-edit.ts
  - packages/@lumenflow/cli/src/wu-edit-operations.ts
  - packages/@lumenflow/cli/src/wu-status.ts
  - packages/@lumenflow/cli/src/plan-link.ts
tests:
  manual:
    - Run wu:create with --plan flag and verify plan field is populated in YAML
    - Run wu:status and verify plan path is displayed
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-schema.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1683.done
dependencies: []
spec_refs:
  - docs/04-operations/plans/WU-1683-plan.md
risks: []
notes: 'WU-1683: Add first-class plan field to WU schema, symmetric with initiative related_plan.
  Reuse existing plan infrastructure (getPlanProtocolRef, plan:link). No auto-detection magic.'
requires_review: false
claimed_mode: worktree
assigned_to: tom@hellm.ai
claimed_at: 2026-02-15T11:05:52.041Z
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-cli-wu-commands-wu-1683
session_id: 922892ea-bd00-46ff-a203-300cbc6676f8
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-15T11:05:52.047Z
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "Context: Plans (Claude Code .claude/plans/, LumenFlow docs/04-operations/plans/) are
  created for WUs but have no formal link back to the WU YAML. Problem: spec_refs is a generic bag
  of links â€” it doesn't distinguish 'this is THE plan' from 'a reference doc'. Sub-agents spawned
  via wu:brief never see the plan. Solution: Add a first-class 'plan' field to the WU schema that
  links to the plan file, similar to how initiatives have plan files."
acceptance:
  - WU schema supports an optional plan field (path to plan file, symmetric with initiative
    related_plan)
  - wu:create --plan sets the plan field in the YAML (reuses existing getPlanProtocolRef)
  - wu:edit --plan <uri> sets or updates the plan field on an existing WU
  - plan:link sets wu.plan (not spec_refs) when linking to a WU, symmetric with initiative
    related_plan
  - wu:status surfaces the linked plan file path

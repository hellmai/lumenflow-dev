id: WU-1006
title: Refactor codebase to use well-known libraries (Library-First)
lane: Core
type: feature
status: done
priority: P2
created: 2026-01-18
code_paths:
  - packages/@lumenflow/core/src/stamp-utils.ts
  - packages/@lumenflow/core/src/error-handler.ts
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/src/gates.ts
tests:
  manual:
    - All date handling uses date-fns (no manual parseInt parsing)
  unit:
    - packages/@lumenflow/core/src/__tests__/stamp-utils.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1006.done
dependencies:
  - WU-1005
spec_refs:
  - internal
risks:
  - Changing date parsing could affect existing stamps if not careful
exposure: backend-only
notes: |
  Audit found most code already uses proper libraries. Key fixes:
  1. stamp-utils.ts: Manual date parsing → date-fns parse/isValid
  2. error-handler.ts: Manual path split → path.basename()
  3. init.ts: String template YAML → js-yaml.dump()
  4. gates.ts: Skip web-specific gates when apps/web doesn't exist (repo-agnostic)
requires_review: false
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |
  Apply Library-First principle to remove brittle custom code.

  Context: CLAUDE.md principle 3 says "Library-First: Search existing
  libraries before custom code". Audit found several brittle patterns.

  Problem: Manual parsing/formatting is error-prone and harder to maintain.

  Solution: Replace custom implementations with well-known libraries.

  High Priority:
  1. stamp-utils.ts - Replace manual date parsing with date-fns
  2. error-handler.ts - Use path.basename() instead of manual split
  3. init.ts - Use js-yaml.dump() for YAML config generation
acceptance:
  - stamp-utils.ts uses date-fns parse() and isValid() for dates
  - error-handler.ts uses path.basename() for script name
  - init.ts uses js-yaml.dump() for .lumenflow.yaml generation
  - Existing tests pass (no behavior change)
  - pnpm format, lint, typecheck → PASS
claimed_mode: worktree
worktree_path: worktrees/core-wu-1006
claimed_at: 2026-01-18T18:25:27.087Z
baseline_main_sha: 2212836b05252d0717a04b1572972ef9bdf2ecd5
session_id: 65325639-1413-4482-b255-bb19346b5b06
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-18T18:25:27.099Z
locked: true
completed_at: 2026-01-18T18:39:47.575Z

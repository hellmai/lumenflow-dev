id: WU-1646
title: Extract wu-done.ts into thin orchestrator and helper modules
lane: 'Framework: CLI WU Commands'
type: refactor
status: ready
priority: P1
created: 2026-02-13
code_paths:
  - packages/@lumenflow/cli/src/wu-done.ts
tests:
  manual:
    - Execute representative wu:done success/failure paths and verify unchanged lifecycle outcomes.
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
    - packages/@lumenflow/cli/__tests__/wu-done.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1646.done
dependencies: []
initiative: INIT-025
phase: 2
blocked_by:
  - WU-1662
  - WU-1663
  - WU-1664
  - WU-1665
risks: []
notes: >-
  INIT-025 Phase 2 WU-B1. Mechanical extraction only, no new abstractions.


  2026-02-13 supersession note: execution sequencing now routes wu:done state-machine foundation
  through WU-1662..WU-1665 under INIT-025 Phase 1; keep this WU as legacy mechanical fallback only
  unless explicitly reactivated.


  2026-02-13 review: blocked by state-machine WUs (WU-1662..WU-1665) which supersede this mechanical
  extraction. If state-machine WUs deliver successfully, this WU should be closed as superseded.


  2026-02-13 WU-1661 reconciliation: supersession guidance formalized in INIT-025-plan.md. After
  Phase 1 completion, evaluate closure. The state-machine decomposition (WU-1662..WU-1665) achieves
  the same structural goals as this mechanical extraction with stronger typed contracts and validated
  transition paths. See INIT-025-plan.md "WU-1646 Supersession Guidance" section for decision rule.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Mechanically decompose packages/@lumenflow/cli/src/wu-done.ts into focused helper
  modules (preflight, gates, ownership, transaction, nudges, audit, staged files, signals) while
  keeping wu-done.ts as a thin orchestrator.
acceptance:
  - wu-done.ts delegates to extracted helpers and shrinks to orchestration flow without behavior
    changes.
  - All existing wu:done lifecycle behavior, failure handling, and output semantics remain
    compatible.
  - Public import/CLI contract for wu:done remains unchanged.

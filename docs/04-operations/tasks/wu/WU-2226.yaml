id: WU-2226
title: lumenflow:upgrade should sync new pnpm script entries from CLI public-manifest
lane: 'Framework: CLI WU Commands'
type: bug
status: ready
priority: P1
created: 2026-02-27
code_paths:
  - packages/@lumenflow/cli/src/lumenflow-upgrade.ts
  - packages/@lumenflow/cli/src/public-manifest.ts
tests:
  manual:
    - Run lumenflow:upgrade on a consumer project missing wu:escalate script and verify it gets added
  unit:
    - packages/@lumenflow/cli/__tests__/lumenflow-upgrade.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2226.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: ui
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: lumenflow:upgrade updates package.json deps and lockfile but does not add new pnpm script entries when a new CLI version introduces new commands (e.g. wu:escalate in 3.6.3). Consumer projects that upgrade get the binary in node_modules/.bin but pnpm wu:escalate fails because the script entry is missing from their package.json. The upgrade command should read the public-manifest and add any missing script entries.
acceptance:
  - lumenflow:upgrade adds missing pnpm script entries from CLI public-manifest to consumer package.json
  - Existing script entries are not overwritten or removed
  - New scripts use the same pattern as init-generated scripts
  - 'Unit tests cover: new script added, existing script preserved, no-op when already present'

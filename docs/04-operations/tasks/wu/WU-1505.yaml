id: WU-1505
title: Add SessionStart dirty-main early-warning across clients
lane: 'Framework: CLI'
type: feature
status: ready
priority: P1
created: 2026-02-07
code_paths:
  - .claude/hooks/session-start-recovery.sh
  - .claude/settings.json
  - packages/@lumenflow/cli/src/hooks/enforcement-generator.ts
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/templates/
tests:
  manual:
    - Start a new session on dirty main and verify warning appears before tool use
  unit:
    - packages/@lumenflow/cli/src/__tests__/hooks/enforcement.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1505.done
dependencies: []
initiative: INIT-017
phase: 1
blocked_by:
  - WU-1501
spec_refs:
  - docs/04-operations/tasks/initiatives/INIT-017.yaml
risks: []
notes: Complements WU-1501/1502 by catching dirty main at session entry time.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: dirty main check currently happens too late in workflow and can be missed until wu:done or manual status checks. Problem: agents can start work in a polluted main checkout without immediate visibility. Solution: add SessionStart dirty-main warning using shared vendor-agnostic detection logic, with vendor hooks generated as thin wrappers.'
acceptance:
  - SessionStart emits warning when main checkout is dirty before any work begins
  - Detection logic is shared in CLI/core and reused by generated vendor hooks
  - Warning is informational (non-blocking) and lists modified/untracked paths with remediation guidance
  - No warning when running inside a worktree checkout

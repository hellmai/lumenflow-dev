id: WU-1920
title: Registry Security Hardening
lane: 'Content: Site Comms'
type: feature
status: ready
priority: P0
created: 2026-02-20
code_paths:
  - apps/web/src/server/pack-registry-handlers.ts
  - apps/web/src/server/pack-registry-store-vercel-blob.ts
  - apps/web/src/server/pack-registry-route-adapters.ts
tests:
  manual:
    - Concurrent publish test verifies no data loss
  unit:
    - apps/web/__tests__/pack-registry-handlers.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1920.done
dependencies: []
initiative: INIT-031
phase: 7
spec_refs:
  - docs/04-operations/plans/INIT-031-plan.md
risks: []
notes: 'Sizing: MEDIUM (~27 calls, 8 files). Strategy: Single Session.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: api
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'S-OWN: No pack ownership. S-IMMUT: No version immutability. S-TARVAL: No tarball
  validation. S-RACE: Registry index race condition. S-RATE: No rate limiting. S-PUBLIC: All
  tarballs publicly accessible.'
acceptance:
  - Pack ownership validated on update (publisher = owner)
  - Duplicate version publish returns 409 Conflict
  - Tarball validated on publish (manifest check, size limit, pack ID match)
  - Optimistic concurrency on registry index (etag/version check)
  - Rate limiting on publish endpoint

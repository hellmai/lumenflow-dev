id: WU-1969
title: Fix gitignore merge path missing runtime state exclusions
lane: 'Framework: CLI Enforcement'
type: bug
status: ready
priority: P2
created: 2026-02-21
code_paths:
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/src/init-templates.ts
tests:
  manual:
    - Run lumenflow init with pre-existing .gitignore and verify all runtime state paths are excluded
  unit:
    - packages/@lumenflow/cli/__tests__/init-gitignore-merge.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1969.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: WU-1965 added auto-merge for .gitignore when the file already exists, but the requiredExclusions array only has 3 entries (node_modules, .lumenflow/telemetry, worktrees). The full GITIGNORE_TEMPLATE has 7 entries including .lumenflow/flow.log, .lumenflow/commands.log, .lumenflow/sessions/, .lumenflow/memory/, and .logs/. Problem: Projects that had a .gitignore before running lumenflow init get an incomplete .gitignore -- runtime state files (.lumenflow/flow.log, sessions, memory) show up as untracked in git status. Discovered testing lumenflow init on lumenflow-cloud. Solution: Sync requiredExclusions array with GITIGNORE_TEMPLATE entries. Extract the exclusion list into a shared constant so the merge path and full template cannot drift.'
acceptance:
  - requiredExclusions array includes all entries from GITIGNORE_TEMPLATE
  - Running init with existing .gitignore produces same exclusions as fresh init
  - Exclusion list is defined once (shared constant) to prevent future drift

id: WU-1046
title: Consolidate YAML handling on yaml package (retire js-yaml)
lane: 'Framework: Core'
type: refactor
status: done
priority: P2
created: 2026-01-21
code_paths:
  - package.json
  - pnpm-lock.yaml
  - packages/@lumenflow/core/src/backlog-sync-validator.ts
  - packages/@lumenflow/core/src/lane-checker.ts
  - packages/@lumenflow/core/src/token-counter.ts
  - packages/@lumenflow/core/src/rebase-artifact-cleanup.ts
  - packages/@lumenflow/core/src/code-paths-overlap.ts
  - packages/@lumenflow/core/src/wu-consistency-checker.ts
  - packages/@lumenflow/cli/src/initiative-edit.ts
  - packages/@lumenflow/cli/src/initiative-create.ts
  - packages/@lumenflow/cli/src/wu-infer-lane.ts
  - packages/@lumenflow/initiatives/src/initiative-yaml.ts
  - docs/04-operations/_frameworks/lumenflow/lumenflow-complete.md
  - apps/docs/src/content/docs/reference/wu-schema.mdx
tests:
  manual:
    - Run wu:claim and wu:spawn on a sample WU and confirm YAML output is stable (no date coercion).
    - Confirm internal + Starlight docs mention YAML library usage and date handling.
  unit:
    - packages/@lumenflow/core/src/__tests__/yaml-roundtrip.test.ts
    - packages/@lumenflow/initiatives/__tests__/initiative-yaml.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1046.done
dependencies: []
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |-
  Context: LumenFlow mixes js-yaml and yaml across core, CLI, initiatives, and memory.
  Problem: js-yaml coerces unquoted YYYY-MM-DD into Date objects and produces inconsistent
  serialization, causing noisy diffs and occasional data corruption.
  Solution: consolidate all YAML parsing/serialization on the yaml package (or shared
  core helpers), migrate imports, remove js-yaml deps, and verify round-trip behavior.
acceptance:
  - All YAML parsing/serialization in core, CLI, initiatives, and memory uses the yaml package (no
    js-yaml imports in production code).
  - js-yaml and @types/js-yaml are removed where no longer needed, with lockfile updates.
  - Date fields remain strings; YAML round-trips are stable (tests pass).
  - Unit tests updated/added for YAML round-trip and initiative YAML behavior.
  - Internal and Starlight docs updated to reflect yaml library usage and date handling.
  - No schema changes beyond intended normalization of YAML output.
claimed_mode: worktree
worktree_path: worktrees/framework-core-wu-1046
claimed_at: 2026-01-21T13:34:04.887Z
baseline_main_sha: c0cc15c312fe40a214f2474eb03b9816570dfe78
session_id: 9843da4d-1190-4b05-b60e-30f6a80ec53f
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-21T13:34:04.895Z
locked: true
completed_at: 2026-01-21T14:07:27.930Z

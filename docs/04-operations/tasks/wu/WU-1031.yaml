id: WU-1031
title: Make wu:done resilient to missing worktree
lane: 'Framework: CLI'
type: bug
status: done
priority: P2
created: 2026-01-20
code_paths:
  - packages/@lumenflow/cli/src/wu-done.ts
  - packages/@lumenflow/cli/__tests__/wu-done.test.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/cli/__tests__/wu-done.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1031.done
dependencies: []
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: wu:done defaults to worktree mode and requires the lane worktree to exist for
  gates, metadata updates, and merge. Problem: Missing worktree prevents completion and can leave
  the WU in an orphaned or partially completed state, even when the lane branch still exists and
  could be completed in branch-only mode. Solution: Treat missing worktree as recoverable with
  explicit --branch-only and improve recovery guidance.'
acceptance:
  - If worktree is missing and --branch-only is provided, wu:done proceeds in branch-only mode with
    a warning and does not require a worktree to exist.
  - If worktree is missing and --branch-only is not provided, wu:done fails with a clear recovery
    message that suggests recreating the worktree or rerunning with --branch-only when the lane
    branch exists.
  - Add unit coverage for mode detection / missing-worktree handling.
  - pnpm format, lint, typecheck -> PASS
claimed_mode: worktree
worktree_path: worktrees/framework-cli-wu-1031
claimed_at: 2026-01-20T13:18:42.546Z
baseline_main_sha: 44ec28559b5bbc7e054dd7c137c76eea47976e0b
session_id: 38dbc6c3-6b3e-443c-b73f-fb9e627e3a4e
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-20T13:18:42.551Z
locked: true
completed_at: 2026-01-20T13:36:07.117Z

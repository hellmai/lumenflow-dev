id: WU-1356
title: Make package manager and script names configurable in .lumenflow.config.yaml
lane: 'Framework: Core'
type: feature
status: done
priority: P2
created: 2026-02-02
code_paths:
  - packages/@lumenflow/core/src/gates-config.ts
  - packages/@lumenflow/core/src/lumenflow-config-schema.ts
  - packages/@lumenflow/cli/src/gates.ts
  - tools/cli-entry.mjs
  - tools/generate-cli-docs.ts
  - apps/docs/src/content/docs/reference/config.mdx
tests:
  manual:
    - Verify npm+jest config works by setting package_manager to npm and test_runner to jest in
      .lumenflow.config.yaml
    - Verify yarn+nx config works by setting package_manager to yarn and custom gates.commands
    - Verify bun config works by setting package_manager to bun in .lumenflow.config.yaml
  unit:
    - packages/@lumenflow/cli/src/__tests__/gates-config.test.ts
  e2e: []
spec_refs:
  - lumenflow://plans/framework-agnosticism
artifacts:
  - .lumenflow/stamps/WU-1356.done
dependencies: []
risks: []
notes: |
  Implementation approach:
  1. Added new schema fields: package_manager, test_runner, build_command, gates.commands
  2. Created resolver functions in gates-config.ts for runtime config resolution
  3. Updated gates.ts to use configured commands instead of hard-coded turbo/vitest
  4. Updated cli-entry.mjs with minimal YAML parser for bootstrap config reading
  5. Added comprehensive tests for npm+jest and yarn+nx configurations
  6. Updated Starlight docs with Framework Agnostic Configuration section
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Full framework agnosticism for LumenFlow CLI. Currently hard-codes pnpm, Turborepo, and
  Vitest throughout gates.ts, cli-entry.mjs, and wu-constants.ts. For true vendor-agnosticism, all
  build tooling should be configurable via .lumenflow.config.yaml with current values as defaults.
  This enables LumenFlow to work with npm/yarn/bun, Nx/plain scripts, Jest/Mocha, etc.
acceptance:
  - 'Add package_manager field to config schema (default: pnpm, options: pnpm/npm/yarn/bun)'
  - Add gates.commands section with configurable test commands (test_full, test_docs_only,
    test_incremental) defaulting to current turbo/vitest
  - 'Add test_runner field (default: vitest) for incremental test detection logic'
  - 'Add build_command override for cli-entry.mjs bootstrap (default: pnpm --filter @lumenflow/cli
    build)'
  - Remove hard-coded turbo references in gates.ts - use configured commands instead
  - Make .turbo ignore pattern configurable or derived from test_runner config
  - Update cli-entry.mjs to use configured package_manager for bootstrap
  - Add tests for npm+jest and yarn+nx configurations
  - Update Starlight docs (lumenflow.dev/reference/config) with full gates configuration examples
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-wu-1356
claimed_at: 2026-02-02T18:00:21.732Z
baseline_main_sha: b6448555187cbc24106572350362bbc4fc640818
session_id: d93c694a-0e60-4ee7-98a2-4d9575c35f61
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-02T18:00:21.737Z
locked: true
completed_at: 2026-02-02T18:17:29.545Z

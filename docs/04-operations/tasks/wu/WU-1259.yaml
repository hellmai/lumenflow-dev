id: WU-1259
title: Add methodology config schema and resolvePolicy() function
lane: 'Framework: Core'
type: feature
status: ready
priority: P2
created: 2026-01-30
code_paths:
  - packages/@lumenflow/core/src/config-schema.ts
  - packages/@lumenflow/core/src/resolve-policy.ts
  - packages/@lumenflow/core/src/lumenflow-config-schema.ts
  - packages/@lumenflow/core/src/resolve-policy.ts
  - packages/@lumenflow/core/src/index.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/core/src/__tests__/resolve-policy.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1259.done
dependencies: []
initiative: INIT-009
phase: 1
spec_refs:
  - ~/.claude/plans/linear-moseying-comet.md
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: >-
  Add methodology.* config schema to .lumenflow.config.yaml and implement resolvePolicy() function
  that produces a resolved policy used by both wu:spawn and gates. This is the single source of
  truth for methodology decisions.


  Config schema:

  - methodology.testing: 'tdd' | 'test-after' | 'none' (default: 'tdd')

  - methodology.architecture: 'hexagonal' | 'layered' | 'none' (default: 'hexagonal')

  - methodology.overrides.coverage_threshold: number

  - methodology.overrides.coverage_mode: 'block' | 'warn' | 'off'


  Precedence: template defaults → methodology.overrides → explicit gates.* → CLI flags
acceptance:
  - methodology.* schema added to config-schema.ts with Zod validation
  - resolvePolicy(config) function returns ResolvedPolicy type
  - Default values preserve current strict behavior (tdd, hexagonal, 90% coverage)
  - Explicit gates.* overrides still take precedence over methodology defaults
  - Unit tests cover all methodology combinations and override precedence

id: WU-1259
title: Add methodology config schema and resolvePolicy() function
lane: 'Framework: Core'
type: feature
status: done
priority: P2
created: 2026-01-30
code_paths:
  - packages/@lumenflow/core/src/resolve-policy.ts
  - packages/@lumenflow/core/src/lumenflow-config-schema.ts
  - packages/@lumenflow/core/src/index.ts
tests:
  manual:
    - Verify acceptance criteria met
  unit:
    - packages/@lumenflow/core/src/__tests__/resolve-policy.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1259.done
dependencies: []
initiative: INIT-009
phase: 1
spec_refs:
  - ~/.claude/plans/linear-moseying-comet.md
risks: []
notes: Completed per acceptance criteria.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: >-
  Add methodology.* config schema to .lumenflow.config.yaml and implement resolvePolicy() function
  that produces a resolved policy used by both wu:spawn and gates. This is the single source of
  truth for methodology decisions.


  Config schema:

  - methodology.testing: 'tdd' | 'test-after' | 'none' (default: 'tdd')

  - methodology.architecture: 'hexagonal' | 'layered' | 'none' (default: 'hexagonal')

  - methodology.overrides.coverage_threshold: number

  - methodology.overrides.coverage_mode: 'block' | 'warn' | 'off'


  Precedence: template defaults → methodology.overrides → explicit gates.* → CLI flags
acceptance:
  - methodology.* schema added to lumenflow-config-schema.ts with Zod validation
  - resolvePolicy(config) function returns ResolvedPolicy type
  - Default values preserve current strict behavior (tdd, hexagonal, 90% coverage)
  - Explicit gates.* overrides still take precedence over methodology defaults
  - Unit tests cover all methodology combinations and override precedence
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-wu-1259
claimed_at: 2026-01-30T19:22:11.413Z
baseline_main_sha: 6e26ed46b7dbb3346f0e1b182bd1a56a7fb71415
session_id: 9bca7100-82ab-427f-8e74-623def66123f
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-30T19:22:11.418Z
locked: true
completed_at: 2026-01-30T19:36:17.572Z

id: WU-1028
title: Fix agent wu:done amnesia - docs and distribution
lane: 'Content: Documentation'
type: feature
status: ready
priority: P1
created: 2026-01-19
code_paths:
  - CLAUDE.md
  - CLAUDE-core.md
  - .claude/constraints-capsule.md
  - .claude/rules/**
  - ai/onboarding/**
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/templates/**
tests:
  manual:
    - After pnpm lumenflow init, CLAUDE.md exists with wu:done warning
    - After pnpm lumenflow init, .claude/agent-rules.md exists
  unit:
    - init command copies template files correctly
  e2e: []
artifacts:
  - .beacon/stamps/WU-1028.done
dependencies: []
risks:
  - Breaking change to init command if templates missing
notes: Critical - if LumenFlow can't do LumenFlow, no one can
requires_review: true
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: >-
  Problem: Agents keep forgetting to run wu:done after completing work.


  Evidence: WU-1027 agent wrote 'To Complete: pnpm wu:done' instead of actually running it. This
  pattern repeats across multiple WUs.


  Root Cause: LumenFlow OS repo is missing critical agent documentation that exists in PatientPath.
  PatientPath agents don't forget because they have 25+ onboarding docs, constraints capsule, and
  rules.


  ARCHITECTURE: Vendor-Agnostic Core + Vendor Integrations


  LumenFlow is vendor-agnostic. Documentation must separate:

  1. Core workflow docs (work with any AI agent)

  2. Vendor integrations (Claude Code, Cursor, Aider, etc.)


  STRUCTURE:


  Core (vendor-agnostic):

  - LUMENFLOW.md - Main entry point, links to core docs

  - .lumenflow/rules/ - Workflow rules (wu-workflow.md, git-safety.md, etc.)

  - .lumenflow/constraints.md - Non-negotiable constraints

  - ai/onboarding/ - Agent onboarding docs (25+ files)


  Vendor Integrations (optional):

  - .claude/ - Claude Code (CLAUDE.md links to LUMENFLOW.md, hooks, settings.json)

  - .cursor/ - Cursor (rules, settings)

  - .aider.conf.yml - Aider

  - .continue/ - Continue


  MIGRATION FROM PATIENTPATH:


  1. Core docs (genericize and move to .lumenflow/):
     - constraints-capsule.md to .lumenflow/constraints.md
     - rules/*.md to .lumenflow/rules/

  2. ai/onboarding/ (genericize):
     - troubleshooting-wu-done.md, first-wu-mistakes.md
     - agent-safety-card.md, quick-ref-commands.md
     - bootloader.md, session-handoff.md
     - context-compaction.md, compaction-recovery.md

  3. Vendor templates (packages/@lumenflow/cli/templates/vendors/):
     - claude/ - CLAUDE.md template pointing to LUMENFLOW.md
     - cursor/ - Cursor rules template
     - aider/ - Aider config template

  4. init.ts updates:
     - Create LUMENFLOW.md (not CLAUDE.md) as core entry
     - Add --vendor flag (claude, cursor, aider, all, none)
     - Auto-detect vendor from environment if no flag
     - Scaffold .lumenflow/ structure
     - Scaffold vendor-specific files based on flag

  Solution:

  1. Migrate all docs from PatientPath to LumenFlow OS

  2. Genericize PatientPath-specific content (PHI, Beacon, etc.)

  3. Restructure into vendor-agnostic core + vendor integrations

  4. Update init.ts with --vendor flag support

  5. LumenFlow OS dogfoods its own docs
acceptance:
  - CLAUDE-core.md created with 'Always wu:done' as explicit rule
  - .claude/constraints-capsule.md migrated from PatientPath (genericized)
  - .claude/rules/ directory with 5 rule files migrated
  - ai/onboarding/ directory created with key files including troubleshooting-wu-done.md
  - init.ts updated to scaffold full .claude/ and ai/ structure
  - LumenFlow OS repo uses its own docs (dogfooding)
  - pnpm format, lint, typecheck pass

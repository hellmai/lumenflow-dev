id: WU-1028
title: Fix agent wu:done amnesia - docs and distribution
lane: 'Content: Documentation'
type: feature
status: ready
priority: P1
created: 2026-01-19
code_paths:
  - CLAUDE.md
  - docs/04-operations/_frameworks/lumenflow/lumenflow-agent-capsule.md
  - docs/templates/CLAUDE.md
  - docs/templates/agent-rules.md
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/templates/**
tests:
  manual:
    - After pnpm lumenflow init, CLAUDE.md exists with wu:done warning
    - After pnpm lumenflow init, .claude/agent-rules.md exists
  unit:
    - init command copies template files correctly
  e2e: []
artifacts:
  - .beacon/stamps/WU-1028.done
dependencies: []
risks:
  - Breaking change to init command if templates missing
notes: Critical - if LumenFlow can't do LumenFlow, no one can
requires_review: true
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |-
  Problem: Agents keep forgetting to run wu:done after completing work.

  Evidence: WU-1027 agent wrote "To Complete: pnpm wu:done" instead of
  actually running it. This pattern repeats across multiple WUs.

  Root Cause: LumenFlow OS repo is missing critical agent documentation
  that exists in PatientPath. PatientPath agents don't forget because
  they have 25+ onboarding docs, constraints capsule, and rules.

  MISSING FROM LUMENFLOW OS (must migrate from PatientPath):

  1. Core docs:
     - CLAUDE-core.md (has "Always wu:done" as rule #4)
     - .claude/constraints-capsule.md (320 lines, "Before wu:done mini audit")

  2. .claude/rules/ (5 files):
     - wu-workflow.md (full WU lifecycle)
     - git-safety.md
     - memory-layer.md
     - agent-activation.md
     - documentation-routing.md

  3. ai/onboarding/ (25+ files including):
     - troubleshooting-wu-done.md (!)
     - first-wu-mistakes.md (!)
     - agent-safety-card.md
     - quick-ref-commands.md
     - bootloader.md
     - session-handoff.md
     - context-compaction.md
     - compaction-recovery.md

  4. Distribution:
     - Templates must ship with @lumenflow/cli
     - pnpm lumenflow init must create full structure
     - Generic versions (remove PatientPath-specific content)

  Solution:
  1. Migrate all docs from PatientPath to LumenFlow OS
  2. Genericize PatientPath-specific content (PHI, Beacon, etc.)
  3. Update init.ts to scaffold full .claude/ and ai/ structure
  4. LumenFlow OS dogfoods its own docs
acceptance:
  - CLAUDE.md has prominent WARNING section about wu:done being mandatory
  - CLAUDE.md states "Work is NOT complete until wu:done runs successfully"
  - docs/templates/CLAUDE.md exists as distributable template
  - docs/templates/agent-rules.md exists with non-negotiables
  - pnpm lumenflow init copies templates to target project
  - Existing lumenflow-agent-capsule.md content merged into templates
  - constraints-capsule.md created or reference removed
  - pnpm format, lint, typecheck pass

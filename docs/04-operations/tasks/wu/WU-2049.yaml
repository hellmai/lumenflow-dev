id: WU-2049
title: 'INIT-034 follow-up: consolidate duplicates and fix naming collisions'
lane: 'Framework: Core Lifecycle'
type: refactor
status: ready
priority: P2
created: 2026-02-22
code_paths:
  - packages/@lumenflow/core/src/constants/lock-constants.ts
  - packages/@lumenflow/core/src/wu-lock-manager.ts
  - packages/@lumenflow/core/src/ports/wu-state.ports.ts
  - packages/@lumenflow/core/src/wu-event-sourcer.ts
  - packages/@lumenflow/core/src/wu-state-indexer.ts
  - packages/@lumenflow/core/src/wu-consistency-detector.ts
  - packages/@lumenflow/core/src/wu-inconsistency-repairer.ts
  - packages/@lumenflow/core/src/spawn/spawn-lane-occupation.ts
tests:
  manual:
    - Verify no LOCK_TIMEOUT_MS name collision across packages
    - Verify duplicate types removed, single canonical source exists
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-lock-manager.test.ts
    - packages/@lumenflow/core/src/__tests__/wu-event-sourcer.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2049.done
dependencies: []
initiative: INIT-034
risks: []
notes: 'Single WU per wu-sizing-guide.md Shallow Multi-File Exception: uniform mechanical changes (rename, deduplicate, remove), each file <=5 lines changed, no structural modifications. All 6 code review findings consolidated.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Code review of INIT-034 found 6 issues (2 medium, 4 low). All are mechanical cleanup: rename LOCK_TIMEOUT_MS to avoid collision with core constant, consolidate duplicate type definitions (LockData, RepairResult, WUStateEntry, CheckpointOptions) to single canonical locations, remove duplicate getErrorMessage helper, clean up hollow spawn-lane-occupation.ts module, and replace type assertions with proper narrowing. Fits Simple tier (<20 files, <50 tool calls) â€” uniform mechanical changes across ~10-12 files.'
acceptance:
  - LOCK_TIMEOUT_MS in wu-lock-manager.ts renamed to avoid collision with core lock-constants.ts
  - 'Duplicate type definitions consolidated: ports are canonical source, concrete modules re-export'
  - getErrorMessage has single canonical location, all callers import from there
  - spawn-lane-occupation.ts either has real logic or is removed (re-exported from parent)
  - Type assertions replaced with proper type guards where feasible
  - All gates green

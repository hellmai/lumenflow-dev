id: WU-1011
title: Fix circular dependency between core and memory packages
lane: Core
type: bug
status: done
priority: P1
created: 2026-01-18
code_paths:
  - packages/@lumenflow/memory/
tests:
  unit: []
  manual:
    - turbo build succeeds without errors
    - Gates run in worktrees
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1011.done
dependencies: []
risks:
  - May require significant refactoring
  - Could break existing imports
exposure: backend-only
notes: |
  Discovered during WU-1008: memory imports from core/dist/* but
  core hasn't built yet during parallel turbo build.

  Root cause: @lumenflow/memory imports specific files from @lumenflow/core:
  - src/mem-checkpoint-core.ts imports from '@lumenflow/core/dist/wu-state-store.js'
  - src/mem-triage-core.ts imports from '@lumenflow/core/dist/lane-checker.js'

  Options:
  1. Move shared types to a new @lumenflow/types package
  2. Use interfaces instead of concrete imports
  3. Restructure to break the cycle
requires_review: false
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |
  Fix the circular dependency between @lumenflow/core and @lumenflow/memory.

  Context: During WU-1008, gates couldn't run in worktrees because
  turbo build fails when building memory before core.

  Problem: memory imports from core/dist/* but during parallel build,
  core dist doesn't exist yet.

  Impact: Gates can't run in worktrees, blocking proper wu:done flow.
acceptance:
  - turbo build succeeds with clean node_modules
  - pnpm gates runs successfully in worktrees
  - No circular import warnings
  - Existing tests pass
claimed_mode: worktree
worktree_path: worktrees/core-wu-1011
claimed_at: 2026-01-18T20:27:22.900Z
baseline_main_sha: 7b3d518211fb405fa6fe5c2b2d8f49616f9dcd0a
session_id: fb3670af-5537-42de-b783-e51842833c42
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-18T20:27:22.908Z
locked: true
completed_at: 2026-01-18T20:32:11.041Z

id: WU-1495
title: Add config-driven cloud auto-detection core
lane: 'Framework: Core'
type: feature
status: done
priority: P1
created: 2026-02-06
code_paths:
  - packages/@lumenflow/core/src/lumenflow-config-schema.ts
  - packages/@lumenflow/core/src/cloud-detect.ts
  - packages/@lumenflow/cli/src/wu-claim.ts
  - .lumenflow.config.yaml
  - packages/@lumenflow/core/src/__tests__/lumenflow-config-schema.test.ts
  - packages/@lumenflow/core/src/__tests__/cloud-detect.test.ts
  - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts
tests:
  manual:
    - Verify precedence and env-signal behavior with cloud.auto_detect true/false and explicit cloud
      activation.
  unit:
    - packages/@lumenflow/core/src/__tests__/lumenflow-config-schema.test.ts
    - packages/@lumenflow/core/src/__tests__/cloud-detect.test.ts
    - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1495.done
dependencies: []
initiative: INIT-016
phase: 6
blocked_by:
  - WU-1490
spec_refs:
  - lumenflow://plans/memoized-baking-sutton.md
risks: []
notes: WU-F1 from branch-pr cloud initiative plan.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: cloud mode activation must remain vendor-agnostic and explicit-first.
  Problem: no schema-backed cloud detection config exists yet for env-signal auto-detect behavior.
  Solution: add cloud.auto_detect and cloud.env_signals schema/defaults plus detection precedence so
  --cloud and LUMENFLOW_CLOUD=1 always win and env-signals are opt-in.'
acceptance:
  - Config schema includes cloud.auto_detect (default false) and cloud.env_signals ({name,
    equals?}[]).
  - 'Detection precedence enforces explicit activation first: --cloud/LUMENFLOW_CLOUD=1 always wins.'
  - Env-signal auto-detection runs only when cloud.auto_detect is true.
  - Core detection logic has no hardcoded vendor-specific environment signals.
  - wu:claim --cloud with LUMENFLOW_CLOUD=1 already set does not conflict or double-apply.
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-wu-1495
claimed_at: 2026-02-06T19:30:51.415Z
baseline_main_sha: b2f973453540ed43ba8e95fc8ddc245b157c0147
session_id: cbf65a81-b588-456d-b19a-f424a9e1ebef
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-06T19:30:51.422Z
locked: true
completed_at: 2026-02-06T19:41:17.512Z

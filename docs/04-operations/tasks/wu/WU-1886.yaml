id: WU-1886
title: Add executeViaPack migration compat guard and fallback telemetry
lane: 'Framework: Core Lifecycle'
type: feature
status: in_progress
priority: P0
created: 2026-02-19
code_paths:
  - packages/@lumenflow/mcp/src/tools-shared.ts
  - packages/@lumenflow/mcp/src/mcp-constants.ts
  - packages/@lumenflow/mcp/src/__tests__/tools-shared.test.ts
tests:
  manual:
    - Run MCP command path with guard on/off and verify fallback behavior and telemetry
  unit:
    - packages/@lumenflow/mcp/src/__tests__/tools-shared.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1886.done
dependencies: []
initiative: INIT-030
phase: 6
blocked_by:
  - WU-1884
plan: lumenflow://plans/WU-1886-plan.md
spec_refs:
  - lumenflow://plans/WU-1886-plan.md
risks: []
notes: >-
  Sizing: Simple (expected 4-8 files, <50 tool calls). Strategy: Single Session with feature-flag
  discipline and rollback-safe defaults. Classification corrected to feature because it introduces
  new compatibility guard + telemetry behavior.

  Released (2026-02-19): Not actively in implementation; returning to ready queue per initiative
  coordination.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Runtime-first routing currently needs a controlled migration mode so partially migrated
  software-delivery commands can continue operating while handlers are moved from CLI fallback to
  native pack execution. This WU introduces an explicit compatibility guard and structured telemetry
  around fallback decisions to make temporary fallback visible, auditable, and easy to disable.
acceptance:
  - A dedicated migration fallback error code is supported only when migration compatibility guard
    is enabled
  - Fallback events include structured telemetry fields needed for migration observability (tool
    name, reason, workspace root)
  - Strict mode disables migration fallback path and returns explicit failure for unmigrated handlers
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-19T13:35:18.819Z
claimed_mode: worktree
worktree_path: /home/USER/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1886
claimed_at: 2026-02-19T13:35:18.810Z
baseline_main_sha: d104648aa55b0de4c35d1270f6d9d81ddd2d0659
session_id: af31271c-1bfa-4576-8cbe-b104975da4c5

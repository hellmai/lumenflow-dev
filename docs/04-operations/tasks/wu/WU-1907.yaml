id: WU-1907
title: Document agent safety architecture, YAML editing policy, and per-client protection gaps
lane: 'Content: Framework Docs'
type: documentation
status: ready
priority: P2
created: 2026-02-19
code_paths:
  - docs/04-operations/_frameworks/lumenflow/**
  - .lumenflow/rules/**
  - .lumenflow/constraints.md
  - docs/04-operations/_frameworks/lumenflow/agent/onboarding/**
  - .claude/CLAUDE.md
  - .cursorrules
  - apps/docs/src/content/docs/reference/agent-safety.mdx
tests:
  manual:
    - Review all doc files render correctly in Starlight dev server
    - Verify starting-prompt.md includes YAML editing policy
    - Verify constraints.md has new constraint 9
  unit: []
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1907.done
dependencies: []
risks: []
notes: Documentation-first approach to agent safety. Enforcement WUs (hooks, GitHub branch protection) to follow once policy is documented and agreed.
requires_review: false
assigned_to: tom@hellm.ai
exposure: documentation
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Document the full protection landscape for agents working in LumenFlow projects. Currently, git hooks (pre-commit, pre-push) provide universal enforcement, Claude Code hooks add tool-level Write/Edit blocking, but other clients (Cursor, Codex, Windsurf) have no tool-level enforcement. YAML config files (.lumenflow.config.yaml, WU specs) are in the allowlist and can be raw-edited by any agent. This WU documents: (1) protection architecture overview with per-layer coverage table, (2) explicit YAML editing policy - always use config:set/wu:edit, never raw Write/Edit, (3) per-client onboarding sections with safe config modification guidance, (4) Starlight reference page for protection architecture. Documentation-first approach before building enforcement tooling.'
acceptance:
  - Protection landscape doc added to docs/04-operations describing all 8 protection layers with coverage matrix
  - YAML editing policy added to .lumenflow/rules as yaml-editing-policy.md - always use config:set or wu:edit, never raw Write/Edit
  - 'constraints.md updated with constraint 9: YAML files must be modified via CLI tooling only'
  - Agent onboarding starting-prompt.md updated with safe config modification section
  - 'Per-client sections added: Claude Code (.claude/CLAUDE.md), Cursor (.cursorrules), generic (starting-prompt.md)'
  - Starlight reference page added at apps/docs/src/content/docs/reference/agent-safety.mdx
  - quick-ref-commands.md updated to include config:set and config:get in commands table

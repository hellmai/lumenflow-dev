id: WU-2257
title: Lane lifecycle commands write directly to main, bypass micro-worktree
lane: 'Framework: CLI Enforcement'
type: bug
status: in_progress
priority: P2
created: 2026-02-27
code_paths:
  - packages/@lumenflow/cli/src/lane-lock.ts
  - packages/@lumenflow/cli/src/lane-validate.ts
  - packages/@lumenflow/cli/src/lane-setup.ts
  - packages/@lumenflow/cli/src/lane-status.ts
tests:
  manual:
    - Run lane:lock and verify it uses micro-worktree isolation in output
    - Run lane:lock --help and verify help text is shown without executing lock
  unit:
    - packages/@lumenflow/cli/src/__tests__/lane-lock.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2257.done
dependencies: []
risks: []
notes: Discovered during INIT-048 planning. lane:lock reformatted 1107 files on main. Reference
  lane-edit.ts for correct micro-worktree pattern.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: lane:lock, lane:validate, and lane:setup --lock write directly to workspace.yaml on the
  current checkout without micro-worktree isolation. lane:lock reformatted 1107 WU YAML files as a
  side effect. Additionally, --help is broken on lane:lock, lane:setup, lane:validate, and
  lane:status â€” they execute normal logic instead of showing help.
acceptance:
  - lane:lock uses micro-worktree isolation like lane:edit
  - lane:validate and lane:setup --lock use micro-worktree isolation
  - --help flag works on all lane lifecycle commands
claimed_mode: worktree
worktree_path: worktrees/framework-cli-enforcement-wu-2257
claimed_at: 2026-02-27T15:48:12.147Z
baseline_main_sha: f6f53294f067053b308daa5121f095878917d9fe
session_id: 8a509da7-ea1f-4899-93dd-1d4ba2f351a7
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-27T15:48:12.153Z

id: WU-2013
title: Decompose wu-state-store.ts into focused services (1274 lines)
lane: 'Framework: Core State Recovery'
type: refactor
status: in_progress
priority: P1
created: 2026-02-22
code_paths:
  - packages/@lumenflow/core/src/wu-state-store.ts
  - packages/@lumenflow/core/src/ports/
tests:
  manual:
    - Run pnpm gates from worktree â€” all tests pass
  unit:
    - packages/@lumenflow/core/src/__tests__/wu-state-store.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2013.done
dependencies: []
initiative: INIT-034
phase: 2
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Split WUStateStore class (50+ public methods, 1274 lines) into focused services:
  wu-event-sourcer.ts (event loading/replaying), wu-state-indexer.ts (byStatus/byLane/byParent
  indexes), wu-lock-manager.ts (file locking and stale detection), wu-repair-service.ts (corruption
  recovery). Keep WUStateStore as thin facade delegating to these services. Extract focused
  interfaces: IWuEventLog, IWuLockManager, IWuStateQuery.'
acceptance:
  - WUStateStore facade is under 200 lines
  - Each extracted service has single responsibility and under 300 lines
  - Focused interfaces IWuEventLog, IWuLockManager, IWuStateQuery defined in ports/
  - All existing wu-state-store tests pass without modification
claimed_mode: worktree
worktree_path: /home/USER/source/hellmai/os/worktrees/framework-core-state-recovery-wu-2013
claimed_at: 2026-02-22T14:38:03.224Z
baseline_main_sha: 9fde424620d16d8498d0a9624bae28fcb9205d8a
session_id: b82b6023-6b72-4fcf-a9b2-9ca11298a52c
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-22T14:38:03.229Z

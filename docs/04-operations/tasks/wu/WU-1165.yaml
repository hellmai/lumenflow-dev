id: WU-1165
title: 'Bug: incremental tests run full suite'
lane: 'Framework: CLI'
type: bug
status: ready
priority: P1
created: 2026-01-28
code_paths:
  - packages/@lumenflow/cli/src/gates.ts
tests:
  manual:
    - Run pnpm gates on a worktree with a single test file change
  unit:
    - packages/@lumenflow/cli/src/__tests__/gates.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1165.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Gates advertise incremental tests but still execute the full suite. Problem: runChangedTests currently falls back to "turbo run test" and never uses the changed-test helper, so worktree gates are slow and noisy. Solution: use the incremental-test helper for changed files with safe fallbacks to full tests when needed.'
acceptance:
  - Changed tests use Vitest --changed (or equivalent) when only code/test files are modified
  - Falls back to full test suite on untracked code/config changes or when incremental detection fails
  - Default behavior remains full suite on main branch
  - Unit tests updated to cover incremental vs fallback paths

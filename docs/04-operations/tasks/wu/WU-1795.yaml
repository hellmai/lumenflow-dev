id: WU-1795
title: 'Phase 4 guardrail: enforce non-increasing MCP runCliCommand shell-out budget'
lane: 'Framework: Core Lifecycle'
type: feature
status: ready
priority: P2
created: 2026-02-17
code_paths:
  - packages/@lumenflow/mcp/src/__tests__/shellout-budget.test.ts
  - packages/@lumenflow/mcp/src/tools
  - .lumenflow/strict-progress-baseline.json
tests:
  manual: []
  unit:
    - packages/@lumenflow/mcp/src/__tests__/shellout-budget.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1795.done
dependencies: []
initiative: INIT-030
phase: 4
blocked_by:
  - WU-1793
spec_refs:
  - /home/USER/.claude/plans/zesty-jumping-pixel.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-030 runtime adoption is incremental, and MCP still has many legacy
  shell-out tools. Problem: without a guardrail, new work can accidentally increase shell-out usage
  and erode migration progress. Solution: add an automated budget/invariant test that fails when
  runCliCommand call sites in MCP tool modules increase beyond a tracked baseline, with an explicit
  update mechanism when intentional growth is approved.'
acceptance:
  - Automated test or invariant computes current runCliCommand call-site count across MCP tool
    modules and compares to a committed baseline.
  - CI fails when shell-out call sites increase above baseline without an explicit baseline update.
  - Documentation in test comments explains how to intentionally update baseline during approved
    migration planning.

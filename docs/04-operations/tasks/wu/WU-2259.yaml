id: WU-2259
title: wu:claim push-only path leaves local-main metadata drift
lane: 'Framework: CLI Enforcement'
type: bug
status: ready
priority: P1
created: 2026-02-27
code_paths:
  - packages/@lumenflow/cli/src/wu-claim.ts,packages/@lumenflow/cli/src/wu-claim-state.ts,packages/@lumenflow/core/src/micro-worktree.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts,packages/@lumenflow/core/src/__tests__/micro-worktree.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2259.done
dependencies: []
risks: []
notes: 'Related context: WU-2248 fixed wu:done --already-merged micro-worktree isolation but claim path still needs hard guarantee for local-main cleanliness in push-only mode.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: wu:claim canonical update path uses push-only micro-worktree, but local main can still end up with claim metadata drift (WU YAML/status/backlog/events) after claim flow. This regresses the local-main-pristine contract and causes follow-on command failures in multi-agent runs.
acceptance:
  - Running wu:claim in push-only canonical-update mode does not leave modified tracked files on local main
  - No claim metadata files are written to main checkout before/after micro-worktree lifecycle
  - Add regression test covering push-only claim path and assert local main remains clean

id: WU-2259
title: wu:claim push-only path leaves local-main metadata drift
lane: 'Framework: CLI Enforcement'
type: bug
status: done
priority: P1
created: 2026-02-27
code_paths:
  - packages/@lumenflow/cli/src/wu-claim-state.ts
  - packages/@lumenflow/cli/src/wu-claim-worktree.ts
tests:
  manual:
    - Run wu:claim for WU-2259 on clean main and verify no tracked files are modified on main after
      claim completes.
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-claim.test.ts
    - packages/@lumenflow/core/src/__tests__/micro-worktree.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2259.done
dependencies: []
risks: []
notes: 'Related context: WU-2248 fixed wu:done --already-merged micro-worktree isolation but claim
  path still needs hard guarantee for local-main cleanliness in push-only mode.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: wu:claim canonical update path uses push-only micro-worktree, but local main can still
  end up with claim metadata drift (WU YAML/status/backlog/events) after claim flow. This regresses
  the local-main-pristine contract and causes follow-on command failures in multi-agent runs.
acceptance:
  - Running wu:claim in push-only canonical-update mode does not leave modified tracked files on
    local main
  - No claim metadata files are written to main checkout before/after micro-worktree lifecycle
  - Add regression test covering push-only claim path and assert local main remains clean
claimed_mode: worktree
worktree_path: worktrees/framework-cli-enforcement-wu-2259
claimed_at: 2026-02-27T16:22:42.272Z
baseline_main_sha: 68cc43982e4e4d1bb455c12b2a97e1d3136a0627
session_id: 87394ffd-3b29-43a4-bb04-21c769b571ac
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-27T16:22:42.279Z
locked: true
completed_at: 2026-02-27T16:45:16.284Z
completed: 2026-02-27

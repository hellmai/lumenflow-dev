id: WU-1965
title: Fix lumenflow init duplicate Created/Skipped output for onboarding docs
lane: 'Framework: CLI Enforcement'
type: bug
status: in_progress
priority: P3
created: 2026-02-21
code_paths:
  - packages/@lumenflow/cli/src/init.ts
  - packages/@lumenflow/cli/src/init-scaffolding.ts
tests:
  manual:
    - Run lumenflow init --client claude on empty dir, verify no file appears in both Created and
      Skipped
  unit:
    - packages/@lumenflow/cli/__tests__/init-scaffold-dedup.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1965.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: Testing lumenflow init from scratch on lumenflow-cloud revealed multiple
  issues. Problem: (1) scaffoldAgentOnboardingDocs() called twice in full+claude mode -- once via
  scaffoldFullDocs(), again via scaffoldClientFiles() (WU-1083) -- causing files to appear in both
  Created and Skipped output. (2) Existing .gitignore is skipped entirely instead of merging
  lumenflow entries (node_modules, .lumenflow/state, etc.), risking accidental commits. (3)
  Generated .lumenflow.config.yaml defaults to vitest/turbo for gates but these are not installed --
  gates will fail on projects that use other tooling. (4) README.md from gh repo create is silently
  deleted with no mention in output. Solution: (1) Guard second scaffoldAgentOnboardingDocs() call
  with !options.full check. (2) When .gitignore exists and mode is skip, auto-merge missing entries
  (or default to --merge for .gitignore). (3) Detect installed test runner and build tool from
  package.json before writing config defaults. (4) If init removes/overwrites a file, list it in
  output.'
acceptance:
  - Files appear in exactly one output section (Created OR Skipped, never both)
  - Existing .gitignore gets lumenflow entries merged in (not skipped)
  - Gate config defaults match installed tooling (no vitest/turbo if not in package.json)
  - If init deletes or overwrites an existing file, it is reported in output
  - Non-full mode (--minimal) still scaffolds onboarding docs for claude client

id: WU-1966
title: Fix web runtime preview fallback diagnostics and workspace root separation
lane: 'Operations: Tooling'
type: bug
status: in_progress
priority: P2
created: 2026-02-21
code_paths:
  - apps/web/src/server/http-surface-runtime.ts
  - apps/web/__tests__/http-surface-runtime-health.test.ts
tests:
  manual:
    - Run @lumenflow/web dev with runtime env vars and verify GET /api/health shows actionable
      runtime diagnostics (env guidance + initialization error when unavailable).
  unit:
    - apps/web/__tests__/http-surface-runtime-health.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1966.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: api
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'The web app currently uses LUMENFLOW_WEB_WORKSPACE_ROOT for two different concerns:
  workspace path safety boundary and kernel runtime workspace selection. When the boundary root is
  broad (for create/connect flows), runtime initialization can fall back to preview mode. Runtime
  initialization errors are also swallowed, which makes /api/health non-actionable. Separate runtime
  workspace env selection and expose initialization failure details in runtime health.'
acceptance:
  - Runtime workspace root resolves from LUMENFLOW_WEB_RUNTIME_WORKSPACE_ROOT first, then falls back
    to LUMENFLOW_WEB_WORKSPACE_ROOT and process.cwd()
  - When runtime is enabled but unavailable, /api/health includes initialization failure detail
  - Preview guidance references both runtime workspace and boundary workspace env vars
  - Unit tests cover env precedence and failure diagnostics
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/operations-tooling-wu-1966
claimed_at: 2026-02-21T16:07:32.347Z
baseline_main_sha: caca968e3a031d5cf2c654cb7545d7b1cdf47812
session_id: 21e6685c-8cd4-4abc-a3a4-2068fab6482d
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-21T16:07:32.353Z

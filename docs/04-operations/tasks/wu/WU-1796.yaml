id: WU-1796
title: 'Phase 3 pack workflow: route gate policy evaluation through Kernel PolicyEngine'
lane: 'Framework: Core Lifecycle'
type: feature
status: done
priority: P1
created: 2026-02-18
code_paths:
  - packages/@lumenflow/packs/software-delivery/manifest.yaml
  - packages/@lumenflow/packs/software-delivery/manifest.ts
tests:
  manual:
    - Run gate execution for a task scope and verify runtime policy allow/deny decision is reflected
      in emitted events/receipts.
    - PackLoader loads manifest with all tools declared and validates structure
  unit:
    - packages/@lumenflow/kernel/src/__tests__/policy-engine.test.ts
    - packages/@lumenflow/kernel/src/__tests__/runtime.test.ts
    - packages/@lumenflow/cli/src/__tests__/gates-runners.test.ts
    - packages/@lumenflow/kernel/src/__tests__/pack-loader.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1796.done
dependencies: []
initiative: INIT-030
phase: 3
spec_refs:
  - /home/tom/.claude/plans/zesty-jumping-pixel.md
risks: []
notes: 'Rewritten to adaptive plan A1. Spec ref: adaptive-finding-adleman.md, zesty-jumping-pixel.md'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-030 Phase 3 requires all 90 remaining MCP tools to be declared in the
  software-delivery pack manifest. Problem: manifest.yaml currently declares only 1 tool
  (git:status) while 90 MCP tools still use runCliCommand shell-outs. Solution: populate
  manifest.yaml with all tool declarations (name, entry, permission, required_scopes) grouped by
  domain, and update manifest.ts programmatic manifest to match.'
acceptance:
  - Software-delivery manifest.yaml declares all 90+ tool entries grouped by domain (wu:*, mem:*,
    initiative:*, lane:*, flow:*, gate:*, file:*, git:*, agent:*, orchestrate:*, state:*, plan:*,
    setup:*)
  - manifest.ts programmatic DomainPackManifest matches manifest.yaml tool declarations
  - PackLoader successfully loads and validates the expanded manifest
  - Pack integrity hash updated in workspace config
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-core-lifecycle-wu-1796
claimed_at: 2026-02-18T08:43:05.295Z
baseline_main_sha: c7238a064c6b594d9183fecece185bb02c7814d9
session_id: c1072942-c0b4-4e07-afb0-94938ea00c9c
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-18T08:43:05.303Z
locked: true
completed_at: 2026-02-18T09:02:37.302Z
completed: 2026-02-18

id: WU-1666
title: Add model-based wu:done pipeline test coverage with @xstate/graph
lane: 'Framework: CLI WU Commands'
type: feature
status: done
priority: P2
created: 2026-02-13
code_paths:
  - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
tests:
  manual:
    - Run full wu:done test suite and confirm model-based transition coverage executes in
      CI-compatible mode.
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1666.done
dependencies: []
initiative: INIT-025
phase: 1
blocked_by:
  - WU-1663
  - WU-1662
spec_refs:
  - lumenflow://plans/INIT-025-plan.md
  - docs/04-operations/_frameworks/lumenflow/wu-sizing-guide.md
risks: []
notes: 'Sizing (wu-sizing-guide): Simple/Medium test-engineering WU (<20 files, likely <50-100 tool
  calls) with fallback path predefined.'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: transition-path coverage for wu:done remains expensive and brittle when
  authored manually across many branches. Problem: missing or under-tested transition paths increase
  regression risk during the state-machine migration. Solution: add model-based transition coverage
  using @xstate/graph (XState v5-compatible) to generate and validate reachable pipeline paths, with
  documented fallback to explicit transition matrix tests if model API constraints appear.'
acceptance:
  - Model-based tests validate reachable wu:done pipeline transitions using @xstate/graph with
    XState v5 compatibility.
  - Generated or enumerated transition-path assertions cover all declared pipeline states and
    critical failure/recovery transitions.
  - Test suite runs in standard gates and documents fallback strategy if model-based API surfaces
    limitations.
  - Coverage evidence demonstrates increased confidence in state-transition regressions versus prior
    baseline.
claimed_mode: worktree
worktree_path: /home/tom/source/hellmai/os/worktrees/framework-cli-wu-commands-wu-1666
claimed_at: 2026-02-13T22:51:15.563Z
baseline_main_sha: 5a81bde9b1f9a5444846bef65fc8f29f4832cf78
session_id: 18220a6e-bfeb-4237-9492-25f2a6adbc06
approved_by:
  - tom@hellm.ai
approved_at: 2026-02-13T22:51:15.571Z
locked: true
completed_at: 2026-02-13T23:15:38.812Z
completed: 2026-02-13

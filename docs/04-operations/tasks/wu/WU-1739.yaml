id: WU-1739
title: Runtime daemon — scheduler, sessions, Unix socket transport
lane: 'Framework: Core Lifecycle'
type: feature
status: ready
priority: P2
created: 2026-02-16
code_paths:
  - packages/@lumenflow/runtime/
tests:
  manual:
    - lumenflow daemon start/stop works, CLI routes through daemon
  unit:
    - packages/@lumenflow/runtime/__tests__/daemon.test.ts
    - packages/@lumenflow/runtime/__tests__/scheduler.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1739.done
dependencies: []
initiative: INIT-029
phase: 4
blocked_by:
  - WU-1735
labels:
  - runtime
  - phase-4
  - daemon
spec_refs:
  - .claude/plans/golden-prancing-cookie.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: INIT-029 Phase 4 — Surfaces + Daemon. Depends on WU-1735 (KernelRuntime). Problem: For persistent agent execution, the system needs a runtime daemon (lumenflowd) that manages scheduling, sessions, and shared state. Currently each CLI invocation is standalone with file-based locking for invariants. Solution: Runtime daemon with manual start (lumenflow daemon start). TaskScheduler for priority queue with lane WIP enforcement. SessionManager for persistent agent sessions with checkpoints. Unix socket transport (net.createServer) for IPC. CLI detects daemon via socket: routes through daemon when running, works in-process when not. Plan: .claude/plans/golden-prancing-cookie.md'
acceptance:
  - lumenflowd daemon starts with lumenflow daemon start and writes PID file
  - TaskScheduler implements priority queue with lane WIP enforcement
  - SessionManager tracks persistent agent sessions with checkpoint/restore
  - Unix socket transport via net.createServer for CLI <-> daemon IPC
  - CLI detects daemon via socket and routes through it when available
  - 'Without daemon: everything works in-process (file locks ensure invariants)'
  - 'With daemon: single-writer mode, no lock contention between CLI invocations'
  - Daemon graceful shutdown on SIGTERM/SIGINT

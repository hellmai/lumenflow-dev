id: WU-1018
title: Migrate missing CLI commands from ExampleApp to @lumenflow/cli
lane: CLI
type: feature
status: done
priority: P1
created: 2026-01-19
code_paths:
  - packages/@lumenflow/cli/src/flow-report.ts
  - packages/@lumenflow/cli/src/flow-bottlenecks.ts
  - packages/@lumenflow/cli/src/metrics-snapshot.ts
  - packages/@lumenflow/cli/src/initiative-bulk-assign-wus.ts
  - packages/@lumenflow/cli/src/agent-issues-query.ts
  - packages/@lumenflow/cli/package.json
  - package.json
tests:
  manual:
    - Run flow-report --help and verify output
    - Run flow-bottlenecks --help and verify output
    - Run metrics-snapshot --dry-run and verify output
    - Run initiative-bulk-assign-wus --help and verify output
    - Run agent-issues-query summary --help and verify output
  unit:
    - packages/@lumenflow/cli/src/__tests__/flow-report.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1018.done
dependencies: []
spec_refs:
  - internal
risks:
  - Breaking changes to existing ExampleApp scripts if function signatures differ
notes: |
  Follow-up from WU-2697 migration verification (ExampleApp).
  ExampleApp has local tools that should be using LumenFlow CLI equivalents.

  Analysis showed:
  - 8 commands already exist in CLI but ExampleApp still uses local versions
  - 5 commands are true gaps that need to be created in @lumenflow/cli
  - compliance-parser.ts was orphaned and has been deleted
requires_review: false
assigned_to: tom@hellm.ai
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: |
  Complete the CLI migration by creating missing commands in @lumenflow/cli.

  Context:
  WU-2697 (ExampleApp) migrated agent tools to use @lumenflow packages. However,
  verification revealed that several CLI commands exist in @lumenflow/cli but
  ExampleApp still uses local ./lib/ versions, and 5 commands are true gaps.

  Problem:
  1. @lumenflow/metrics has library functions but no CLI wrappers:
     - generateFlowReport() needs flow-report CLI
     - analyzeBottlenecks() needs flow-bottlenecks CLI
     - captureMetricsSnapshot() needs metrics-snapshot CLI
  2. Two genuine gap commands need migration:
     - initiative-bulk-assign-wus (bulk WU assignment with micro-worktree)
     - agent-issues-query (incident summary querying)

  Solution:
  Create 5 new CLI commands in @lumenflow/cli that:
  - Use @lumenflow/core and @lumenflow/metrics for library functions
  - Follow existing CLI patterns (commander.js, createWUParser)
  - Include testability guards (WU-1366 pattern)
  - Register in package.json bin section
  - Add pnpm scripts to root package.json
acceptance:
  - flow-report CLI command created, wraps generateFlowReport from @lumenflow/metrics
  - flow-bottlenecks CLI command created, wraps analyzeBottlenecks from @lumenflow/core
  - metrics-snapshot CLI command created, wraps captureMetricsSnapshot from @lumenflow/metrics
  - initiative-bulk-assign-wus migrated to CLI using @lumenflow/core imports
  - agent-issues-query migrated to CLI using @lumenflow/agent imports
  - All 5 commands registered in @lumenflow/cli/package.json bin section
  - Root package.json has flow:report, flow:bottlenecks, metrics:snapshot scripts
  - pnpm build succeeds in packages/@lumenflow/cli
  - pnpm format, lint, typecheck â†’ PASS
claimed_mode: worktree
worktree_path: worktrees/cli-wu-1018
claimed_at: 2026-01-19T11:31:39.344Z
baseline_main_sha: e308fb74c7df5705136cfd9aa707c4936878c9be
session_id: 881cde2f-fa09-4106-898b-8918bb338117
approved_by:
  - tom@hellm.ai
approved_at: 2026-01-19T11:31:39.352Z
locked: true
completed_at: 2026-01-19T11:46:33.344Z

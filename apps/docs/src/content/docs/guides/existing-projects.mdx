---
title: Existing Projects
description: Add LumenFlow to an existing codebase
---

import { Steps, Tabs, TabItem, Aside, FileTree } from '@astrojs/starlight/components';

Adding LumenFlow to an existing project takes about 15 minutes. This guide walks through the process without disrupting your current workflow.

## Prerequisites

Before starting:

- Git repository (any platform)
- Node.js 18+ (for CLI) or skip CLI and use GitHub App only
- Understanding of [Work Units](/concepts/work-units) and [Gates](/concepts/gates)

## Quick Overview

LumenFlow adds:

- `.lumenflow.config.yaml` - Configuration file
- `LUMENFLOW.md` - Workflow entry point
- `.lumenflow/` - State and constraints
- `docs/04-operations/tasks/` - WU specs and backlog (optional)
- Git hooks for enforcement (optional)

It does **not** require:

- Changing your existing code structure
- Migrating existing tickets immediately
- Modifying CI/CD pipelines (optional enhancement)
- Team-wide adoption at once

## Installation Methods

<Tabs>
  <TabItem label="CLI (Recommended)">

### Full Setup with CLI

The CLI provides the fastest path to adoption.

<Steps>

1. **Install the CLI**

   <Tabs syncKey="pkg">
     <TabItem label="pnpm">```bash pnpm add -D @lumenflow/cli ```</TabItem>
     <TabItem label="npm">```bash npm install -D @lumenflow/cli ```</TabItem>
   </Tabs>

2. **Initialize LumenFlow**

   ```bash
   npx lumenflow-init
   ```

   Answer the prompts or use flags for non-interactive setup:

   ```bash
   npx lumenflow-init \
     --full \
     --framework nextjs \
     --main-branch main
   ```

3. **Review generated files**

   The init command creates:

   <FileTree>
   - .lumenflow.config.yaml (your configuration)
   - LUMENFLOW.md (workflow entry point)
   - .lumenflow/
     - constraints.md (non-negotiable rules)
     - agents/ (AI agent guidance)
   - docs/04-operations/tasks/ (with --full)
     - backlog.md
     - status.md
     - wu/ (WU spec directory)
   </FileTree>

4. **Add scripts to package.json**

   ```json
   {
     "scripts": {
       "wu:create": "wu-create",
       "wu:claim": "wu-claim",
       "wu:done": "wu-done",
       "gates": "gates"
     }
   }
   ```

5. **Install git hooks (optional)**

   ```bash
   npx husky init
   npx husky add .husky/pre-commit "npx gates --quick"
   ```

</Steps>

  </TabItem>
  <TabItem label="Manual Setup">

### Manual Setup (No CLI)

If you prefer not to use the CLI or are using a non-Node.js project.

<Steps>

1. **Create configuration file**

   Create `.lumenflow.config.yaml` in your repo root:

   ```yaml
   version: '2.0'

   directories:
     wu_specs: docs/04-operations/tasks/wu
     backlog: docs/04-operations/tasks/backlog.md
     status: docs/04-operations/tasks/status.md
     stamps: .lumenflow/stamps

   lanes:
     enforcement:
       require_parent: true
       allow_custom: false
     definitions:
       - name: 'Framework: Core'
         wip_limit: 2
       - name: 'Experience: UI'
         wip_limit: 2
       - name: 'Operations: Infrastructure'
         wip_limit: 1
       - name: 'Content: Documentation'
         wip_limit: 1

   gates:
     execution:
       format: 'npm run format:check'
       lint: 'npm run lint'
       typecheck: 'npm run typecheck'
       test: 'npm test'

   git:
     main_branch: main
   ```

2. **Create LUMENFLOW.md**

   ```markdown
   # LumenFlow Workflow Guide

   This project uses LumenFlow for AI-native development.

   ## Quick Start

   1. Review backlog: `docs/04-operations/tasks/backlog.md`
   2. Create WU: Create YAML in `docs/04-operations/tasks/wu/`
   3. Claim WU: Update status to `in_progress`
   4. Work: Implement per acceptance criteria
   5. Complete: Run gates, mark done, create stamp

   ## Reference

   - [LumenFlow Documentation](https://lumenflow.dev)
   - [Configuration](.lumenflow.config.yaml)
   ```

3. **Create directory structure**

   ```bash
   mkdir -p docs/04-operations/tasks/wu
   mkdir -p .lumenflow/stamps
   ```

4. **Create backlog.md**

   ```markdown
   # Backlog

   ## Ready

   ## In Progress

   ## Done
   ```

5. **Create your first WU**

   Create `docs/04-operations/tasks/wu/WU-001.yaml`:

   ```yaml
   id: WU-001
   title: Initial LumenFlow setup
   lane: 'Operations: Infrastructure'
   type: chore
   status: done
   priority: P2
   description: |
     Set up LumenFlow workflow framework.
   acceptance:
     - Configuration file created
     - Directory structure established
   code_paths:
     - .lumenflow.config.yaml
     - LUMENFLOW.md
   ```

</Steps>

  </TabItem>
</Tabs>

## Mapping Existing Structure

### Your Gates Are Already There

Most projects already have the tools LumenFlow gates run. Map them:

| Gate       | Your Existing Command    | LumenFlow Config                 |
| ---------- | ------------------------ | -------------------------------- |
| Format     | `npm run prettier`       | `gates.execution.format`         |
| Lint       | `npm run eslint`         | `gates.execution.lint`           |
| Typecheck  | `npm run tsc`            | `gates.execution.typecheck`      |
| Test       | `npm test`               | `gates.execution.test`           |

Example mapping:

```yaml
gates:
  execution:
    format: 'npm run prettier -- --check'
    lint: 'npm run eslint'
    typecheck: 'npm run tsc --noEmit'
    test: 'npm test'
```

### Your Branches Map to Lanes

If you have team branches or areas:

| Current Branches         | LumenFlow Lanes              |
| ------------------------ | ---------------------------- |
| `feature/*`, `frontend-*` | `Experience: UI`            |
| `api/*`, `backend-*`     | `Framework: Core`            |
| `infra/*`, `devops-*`    | `Operations: Infrastructure` |
| `docs/*`                 | `Content: Documentation`     |

### Your PRs Map to WUs

Each pull request or ticket becomes a Work Unit:

| PR/Ticket Field | WU Field                    |
| --------------- | --------------------------- |
| Title           | `title`                     |
| Description     | `description`               |
| Labels          | `lane`, `type`              |
| Acceptance      | `acceptance`                |
| Assignee        | `assigned_to`               |

## Gradual Adoption Path

You don't need to migrate everything at once.

### Week 1: Shadow Mode

Run LumenFlow alongside existing workflow:

1. Install and configure
2. Create WUs for new work only
3. Keep using existing tickets for in-progress work
4. Run gates manually to test

<Aside type="tip">
  Use `--dry-run` flags to test without committing changes while you learn the workflow.
</Aside>

### Week 2-3: Parallel Operation

1. New work starts as WUs
2. Existing PRs complete normally
3. When a PR completes, optionally create a retroactive WU for history
4. Team familiarizes with commands

### Week 4+: Full Adoption

1. All new work uses WUs
2. Close out ticket system (or keep for roadmap/epics)
3. Install GitHub App for enforcement
4. Enable git hooks

## Coexistence Strategies

### Keep External Roadmap

LumenFlow handles execution. Keep your roadmap tool:

```
Product Roadmap (Linear/Notion/Jira)
    ↓ Quarterly planning
Initiatives (INIT-001, INIT-002)
    ↓ Broken into
Work Units (WU-001, WU-002, ...)
    ↓ Executed via
LumenFlow
```

Link them:

```yaml
# WU-042.yaml
id: WU-042
title: Add search autocomplete
initiative: INIT-008
external_refs:
  - 'LINEAR-1234'
  - 'JIRA-ABC-567'
```

### Hybrid Team Adoption

Not everyone needs to adopt simultaneously:

| Role            | Adoption Level                    |
| --------------- | --------------------------------- |
| AI Agents       | Full LumenFlow (required)         |
| Backend Team    | Full LumenFlow (recommended)      |
| Frontend Team   | Gradual adoption                  |
| Product Manager | Continues using roadmap tool      |

### Existing CI/CD

LumenFlow gates can run in CI without replacing your existing pipeline:

```yaml
# .github/workflows/gates.yml
name: LumenFlow Gates
on: [pull_request]

jobs:
  gates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: hellmai/lumenflow-gates@v1
        with:
          skip-on-no-wu: true  # Only run if WU exists
```

## Common Concerns

### "We have hundreds of open tickets"

You don't need to migrate them. Options:

1. **Ignore old tickets** - Start fresh with WUs for new work
2. **Migrate incrementally** - Convert tickets as you work on them
3. **Bulk migrate** - Script conversion (see [Migration Guide](/guides/migration))

### "Our team isn't ready for trunk-based development"

LumenFlow supports gradual transition:

1. Start with worktrees (isolated, like feature branches)
2. Gates run in worktrees, merge when passing
3. This feels like PRs but with automated quality

### "We need code review"

LumenFlow doesn't eliminate review, it changes when:

- Gates replace mechanical review (format, lint, types, tests)
- Human review for security, architecture, judgment calls

```yaml
# WU spec
requires_review: true
reviewers:
  - security@company.com
```

### "Our tests are slow"

Use gate presets with test splitting:

```yaml
gates:
  execution:
    test: 'npm test -- --shard=1/3'  # Parallel shards
    test_timeout: 300000  # 5 minute timeout
```

Or run fast tests in gates, slow tests in CI.

## Verification

After setup, verify everything works:

```bash
# 1. Create a test WU
npx wu-create \
  --id WU-TEST \
  --title "Test LumenFlow setup" \
  --lane "Operations: Infrastructure" \
  --type chore

# 2. Claim it
npx wu-claim --id WU-TEST --lane "Operations: Infrastructure"

# 3. Make a trivial change in worktree
cd worktrees/operations-infrastructure-wu-test
echo "# LumenFlow works" >> README.md

# 4. Run gates
npx gates

# 5. Complete (from main checkout)
cd ../..
npx wu-done --id WU-TEST

# 6. Check results
ls .lumenflow/stamps/WU-TEST.done  # Should exist
```

## Next Steps

- [Migration Guide](/guides/migration) - Migrate from existing tools
- [Solo Developer Workflow](/guides/solo-workflow) - Simpler setup for individuals
- [Team Workflow](/guides/team-workflow) - Team-specific practices
- [CLI Reference](/reference/cli) - Full command documentation

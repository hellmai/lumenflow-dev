---
title: Configuration
description: LumenFlow configuration file reference
---

{/* AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY */}
{/* Run `pnpm docs:generate` to regenerate from source */}
{/* Includes formatting stabilization (WU-1157) */}

LumenFlow is configured via `.lumenflow.config.yaml` in your project root.

## Minimal Config

```yaml
version: '2.0'

lanes:
  definitions:
    - name: 'Framework: Core'
      code_paths: ['src/**']

gates:
  format: true
  lint: true
  typecheck: true
  test: true
```

## Config Sections

### directories

Directory paths configuration

| Field            | Type   | Default                          | Description |
| ---------------- | ------ | -------------------------------- | ----------- |
| `appsWeb`        | string | `"apps/web/"`                    |             |
| `worktrees`      | string | `"worktrees/"`                   |             |
| `ai`             | string | `"ai/"`                          |             |
| `claude`         | string | `".claude/"`                     |             |
| `docs`           | string | `"docs/"`                        |             |
| `packages`       | string | `"packages/"`                    |             |
| `tools`          | string | `"tools/"`                       |             |
| `memoryBank`     | string | `"memory-bank/"`                 |             |
| `wuDir`          | string | `"docs/04-operations/tasks/wu"`  |             |
| `initiativesDir` | string | `"docs/04-operations/tasks/i...` |             |
| `backlogPath`    | string | `"docs/04-operations/tasks/b...` |             |
| `statusPath`     | string | `"docs/04-operations/tasks/s...` |             |
| `skillsDir`      | string | `".claude/skills"`               |             |
| `agentsDir`      | string | `".claude/agents"`               |             |
| `plansDir`       | string | `"docs/04-operations/plans"`     |             |
| `templatesDir`   | string | `".lumenflow/templates"`         |             |
| `onboardingDir`  | string | `"docs/04-operations/_framew...` |             |

### state

State paths configuration (.lumenflow directory structure)

| Field           | Type   | Default                     | Description |
| --------------- | ------ | --------------------------- | ----------- |
| `base`          | string | `".lumenflow"`              |             |
| `stateDir`      | string | `".lumenflow/state"`        |             |
| `archiveDir`    | string | `".lumenflow/archive"`      |             |
| `stampsDir`     | string | `".lumenflow/stamps"`       |             |
| `mergeLock`     | string | `".lumenflow/merge.lock"`   |             |
| `telemetry`     | string | `".lumenflow/telemetry"`    |             |
| `flowLog`       | string | `".lumenflow/flow.log"`     |             |
| `sessions`      | string | `".lumenflow/sessions"`     |             |
| `incidents`     | string | `".lumenflow/incidents"`    |             |
| `commandsLog`   | string | `".lumenflow/commands.log"` |             |
| `eventArchival` | object | `[object Object]`           |             |

### git

Git configuration

| Field                         | Type     | Default           | Description |
| ----------------------------- | -------- | ----------------- | ----------- |
| `mainBranch`                  | string   | `"main"`          |             |
| `defaultRemote`               | string   | `"origin"`        |             |
| `laneBranchPrefix`            | string   | `"lane/"`         |             |
| `tempBranchPrefix`            | string   | `"tmp/"`          |             |
| `realGitPath`                 | string   | `"/usr/bin/git"`  |             |
| `maxBranchDrift`              | integer  | `20`              |             |
| `branchDriftWarning`          | integer  | `15`              |             |
| `branchDriftInfo`             | integer  | `10`              |             |
| `requireRemote`               | boolean  | `true`            |             |
| `agentBranchPatterns`         | string[] | `[]`              |             |
| `agentBranchPatternsOverride` | string[] | `-`               |             |
| `disableAgentPatternRegistry` | boolean  | `false`           |             |
| `push_retry`                  | object   | `[object Object]` |             |

### wu

WU (Work Unit) configuration

| Field                  | Type    | Default      | Description |
| ---------------------- | ------- | ------------ | ----------- |
| `idPattern`            | string  | `"^WU-\d+$"` |             |
| `minDescriptionLength` | integer | `50`         |             |
| `maxCommitSubject`     | integer | `100`        |             |
| `defaultPriority`      | string  | `"P2"`       |             |
| `defaultStatus`        | string  | `"ready"`    |             |
| `defaultType`          | string  | `"feature"`  |             |

### gates

Quality gates configuration

| Field                       | Type     | Default           | Description |
| --------------------------- | -------- | ----------------- | ----------- | -------- | --- |
| `maxEslintWarnings`         | integer  | `100`             |             |
| `enableCoverage`            | boolean  | `true`            |             |
| `minCoverage`               | number   | `90`              |             |
| `enableSafetyCriticalTests` | boolean  | `true`            |             |
| `enableInvariants`          | boolean  | `true`            |             |
| `execution`                 | object   | `-`               |             |
| `commands`                  | object   | `[object Object]` |             |
| `ignore_patterns`           | string[] | `-`               |             |
| `lane_health`               | "warn"   | "error"           | "off"       | `"warn"` |     |

### memory

Memory layer configuration

| Field                    | Type    | Default           | Description                                             |
| ------------------------ | ------- | ----------------- | ------------------------------------------------------- |
| `directory`              | string  | `"memory-bank/"`  | Memory storage directory                                |
| `sessionTtl`             | integer | `604800000`       | Session TTL in milliseconds (default: 7 days)           |
| `checkpointTtl`          | integer | `2592000000`      | Checkpoint TTL in milliseconds (default: 30 days)       |
| `enableAutoCleanup`      | boolean | `true`            | Enable automatic cleanup of expired nodes               |
| `progress_signals`       | object  | `-`               | Progress signals configuration (optional)               |
| `signalCleanup`          | object  | `[object Object]` | Signal cleanup TTL and retention policy                 |
| `spawn_context_max_size` | integer | `4096`            | Max size in bytes for spawn memory context              |
| `enforcement`            | object  | `-`               | Memory enforcement configuration (INIT-015, optional)   |
| `decay`                  | object  | `-`               | Decay-based archival configuration (INIT-015, optional) |

### memory.progress_signals

Progress signals configuration for sub-agent coordination (WU-1203)

| Field             | Type    | Default | Description                                        |
| ----------------- | ------- | ------- | -------------------------------------------------- |
| `enabled`         | boolean | `false` | When true, signals are required at trigger points  |
| `frequency`       | integer | `0`     | Tool calls between auto-signals (0 = no frequency) |
| `on_milestone`    | boolean | `true`  | Signal after completing each acceptance criterion  |
| `on_tests_pass`   | boolean | `true`  | Signal when tests first pass                       |
| `before_gates`    | boolean | `true`  | Signal before running quality gates                |
| `on_blocked`      | boolean | `true`  | Signal when blocked or waiting on dependencies     |
| `auto_checkpoint` | boolean | `false` | Automatically create checkpoint with each signal   |

### memory.enforcement

Memory enforcement configuration (INIT-015, WU-1471). Controls auto-checkpointing and checkpoint requirements for wu:done. Optional -- when not provided, existing warn behavior applies.

| Field                         | Type   | Default   | Description                                                 |
| ----------------------------- | ------ | --------- | ----------------------------------------------------------- |
| `auto_checkpoint`             | object | see below | Auto-checkpoint hook configuration                          |
| `require_checkpoint_for_done` | enum   | `"warn"`  | Checkpoint gate on wu:done: `"off"`, `"warn"`, or `"block"` |

### memory.enforcement.auto_checkpoint

Controls automatic checkpointing via PostToolUse and SubagentStop Claude Code hooks.

| Field                 | Type    | Default | Description                                                           |
| --------------------- | ------- | ------- | --------------------------------------------------------------------- |
| `enabled`             | boolean | `false` | Generate PostToolUse + SubagentStop hooks for automatic checkpointing |
| `interval_tool_calls` | integer | `30`    | Number of tool calls between automatic checkpoints                    |

When `enabled: true` and the enforcement hooks master switch is active, `pnpm lumenflow:integrate --client claude-code` generates hook scripts that background checkpoint writes in a defensive subshell. PostToolUse checkpoints are counter-based (per-WU); SubagentStop always checkpoints.

### memory.decay

Memory decay policy configuration (INIT-015, WU-1474). Controls automated archival of stale memory nodes during lifecycle events. Optional -- when not provided, no automatic decay archival runs.

| Field            | Type    | Default     | Description                                                 |
| ---------------- | ------- | ----------- | ----------------------------------------------------------- |
| `enabled`        | boolean | `false`     | Enable decay-based archival                                 |
| `threshold`      | number  | `0.1`       | Decay score below which nodes are archived (0 to 1)         |
| `half_life_days` | integer | `30`        | Half-life for decay scoring in days (positive integer)      |
| `trigger`        | enum    | `"on_done"` | When to trigger: `"on_done"` (during wu:done) or `"manual"` |

When `trigger: "on_done"`, wu:done invokes decay archival after gates pass. Errors never block wu:done completion (fail-open). When `trigger: "manual"`, decay only runs via `pnpm mem:cleanup`.

### ui

UI configuration

| Field                | Type    | Default | Description |
| -------------------- | ------- | ------- | ----------- |
| `errorBoxWidth`      | integer | `70`    |             |
| `statusPreviewLines` | integer | `5`     |             |
| `readinessBoxWidth`  | integer | `50`    |             |

### yaml

YAML serialization configuration

| Field       | Type    | Default | Description |
| ----------- | ------- | ------- | ----------- |
| `lineWidth` | integer | `100`   |             |

### agents

Agents configuration

| Field           | Type   | Default           | Description |
| --------------- | ------ | ----------------- | ----------- |
| `defaultClient` | string | `"claude-code"`   |             |
| `clients`       | object | `[object Object]` |             |
| `methodology`   | object | `[object Object]` |             |

### agents.methodology

Methodology defaults (agent-facing project defaults)

| Field         | Type       | Default                          | Description  |
| ------------- | ---------- | -------------------------------- | ------------ | --- |
| `enabled`     | boolean    | `true`                           |              |
| `enforcement` | "required" | "recommended"                    | `"required"` |     |
| `principles`  | string[]   | `["TDD","Hexagonal Architect...` |              |
| `notes`       | string     | `-`                              |              |

### agents.clients.\*

Client configuration (per-client settings)

| Field         | Type     | Default | Description |
| ------------- | -------- | ------- | ----------- |
| `preamble`    | unknown  | `-`     |             |
| `skillsDir`   | string   | `-`     |             |
| `agentsDir`   | string   | `-`     |             |
| `blocks`      | object[] | `[]`    |             |
| `skills`      | object   | `-`     |             |
| `enforcement` | object   | `-`     |             |

## Framework Agnostic Configuration

LumenFlow supports different package managers and test runners. Configure these at the top level of your config file:

| Field             | Type                                       | Default                                | Description                                |
| ----------------- | ------------------------------------------ | -------------------------------------- | ------------------------------------------ |
| `package_manager` | `"pnpm"` \| `"npm"` \| `"yarn"` \| `"bun"` | `"pnpm"`                               | Package manager for CLI operations         |
| `test_runner`     | `"vitest"` \| `"jest"` \| `"mocha"`        | `"vitest"`                             | Test runner for incremental test detection |
| `build_command`   | string                                     | `"pnpm --filter @lumenflow/cli build"` | Custom build command for CLI bootstrap     |

### Example: npm + Jest

```yaml
version: '2.0'

# WU-1356: Framework agnostic settings
package_manager: npm
test_runner: jest
build_command: npm run build

gates:
  commands:
    test_full: npm test
    test_docs_only: npm test -- --testPathPattern=docs
    test_incremental: npm test -- --onlyChanged
```

### Example: yarn + Nx

```yaml
version: '2.0'

package_manager: yarn
test_runner: jest
build_command: yarn nx build @lumenflow/cli

gates:
  commands:
    test_full: yarn nx run-many --target=test --all
    test_docs_only: yarn nx test docs
    test_incremental: yarn nx affected --target=test
```

### Example: bun

```yaml
version: '2.0'

package_manager: bun
test_runner: vitest
build_command: bun run --filter @lumenflow/cli build

gates:
  commands:
    test_full: bun test
    test_incremental: bun test --changed
```

## Environment Overrides

Config values can be overridden via environment variables:

```bash
LUMENFLOW_MAIN_BRANCH=develop pnpm wu:done --id WU-001
```

| Variable                | Overrides           |
| ----------------------- | ------------------- |
| `LUMENFLOW_CONFIG`      | Config file path    |
| `LUMENFLOW_MAIN_BRANCH` | `git.mainBranch`    |
| `LUMENFLOW_WU_SPECS`    | `directories.wuDir` |

## Validation

Validate your config:

```bash
pnpm exec lumenflow validate
```

---

## Next Steps

- [CLI Commands](/reference/cli) – All commands
- [WU Schema](/reference/wu-schema) – WU YAML structure

version: '2.0'
project: lumenflow

# WU-1022: Lane enforcement configuration
# Controls how lane format validation behaves
lanes:
  enforcement:
    # When true, lanes MUST use "Parent: Sublane" format if parent has taxonomy
    require_parent: true
    # When false, only lanes in the taxonomy are allowed. When true, custom lanes can be used.
    allow_custom: false

  # Lane definitions with full "Parent: Sublane" format
  # These map to the taxonomy in .lumenflow.lane-inference.yaml
  definitions:
    - name: 'Framework: Core'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/core/**'

    - name: 'Framework: CLI'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/cli/**'

    - name: 'Framework: Memory'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/memory/**'

    - name: 'Framework: Agent'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/agent/**'

    - name: 'Framework: Metrics'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/metrics/**'

    - name: 'Framework: Initiatives'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/initiatives/**'

    - name: 'Framework: Shims'
      wip_limit: 1
      code_paths:
        - 'packages/@lumenflow/shims/**'

    - name: 'Operations: Infrastructure'
      wip_limit: 1
      code_paths:
        - 'apps/**'
        - 'actions/**'

    - name: 'Operations: CI/CD'
      wip_limit: 1
      code_paths:
        - '.github/**'

    - name: 'Content: Documentation'
      wip_limit: 4
      # WU-1187: wip_justification required when wip_limit > 1
      wip_justification: 'Docs WUs are low-conflict parallel work targeting different pages'
      # WU-1322: lock_policy controls how lane branches are locked during WU execution
      # Values: 'all' (default) | 'active' (overlap-based) | 'none' (no locking)
      # lock_policy: 'none'  # Uncomment to allow parallel doc work without lane locking
      code_paths:
        - 'docs/**'
        - 'apps/docs/**'

git:
  main_branch: main
  branch_pattern: 'lane/{lane}/{wu_id}'

directories:
  wu_specs: 'docs/04-operations/tasks/wu'
  backlog: 'docs/04-operations/tasks/backlog.md'
  status: 'docs/04-operations/tasks/status.md'
  stamps: '.lumenflow/stamps'
  skillsDir: '.claude/skills'
  agentsDir: '.claude/agents'

worktree_pattern: 'worktrees/{lane}-{wu_id}'

# WU-1053: Agent and skill configuration for AI clients
agents:
  defaultClient: 'claude-code'
  clients:
    claude-code:
      preamble: true
      skillsDir: '.claude/skills'
      agentsDir: '.claude/agents'
      skills:
        instructions: 'Load skills based on WU context:'
        recommended:
          - wu-lifecycle
          - worktree-discipline
        byLane:
          'Framework: Core':
            - tdd-workflow
            - lumenflow-gates
          'Framework: CLI':
            - tdd-workflow
            - lumenflow-gates
          'Content: Documentation':
            - worktree-discipline
          'Operations: Infrastructure':
            - orchestration
      blocks:
        - title: 'Claude Code Best Practices'
          content: |
            - Use TodoWrite for multi-step tasks
            - Run gates before wu:done
            - Never use --no-verify
            - Load skills via /skill <name>
    codex-cli:
      preamble: true
      skillsDir: '.claude/skills'
    gemini-cli:
      preamble: true
      skillsDir: '.claude/skills'

# WU-1203: Memory layer configuration
# Controls memory persistence, checkpoints, and sub-agent coordination signals
memory:
  # Memory directory (default: 'memory-bank/')
  directory: 'memory-bank/'
  # Progress signals for sub-agent coordination
  # When enabled, spawn prompts include mandatory signal directives
  # progress_signals:
  #   enabled: false        # Set true to make signals mandatory in spawn prompts
  #   frequency: 0          # Signal every N tool calls (0 = disabled)
  #   on_milestone: true    # Signal after each acceptance criterion completed
  #   on_tests_pass: true   # Signal when tests first pass
  #   before_gates: true    # Signal before running gates
  #   on_blocked: true      # Signal when work is blocked
  #   auto_checkpoint: false # Automatically checkpoint memory at signal milestones

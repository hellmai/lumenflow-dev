# Lane Inference Configuration for LumenFlow OS
#
# Defines sub-lane taxonomy with code_paths patterns and keywords for automated inference.
# Used by @lumenflow/core lane-inference.ts to suggest sub-lanes during WU creation.
#
# Taxonomy: 19 sub-lanes across 3 parent lanes
# - Framework: 13 sub-lanes (Core Lifecycle/Validation/State Recovery, CLI WU/Memory/Orchestration/Enforcement, MCP, Memory, Agent, Metrics, Initiatives, Shims)
# - Operations: 3 sub-lanes (Runtime, Tooling, Automation)
# - Content: 3 sub-lanes (Specs Governance, Framework Docs, Site Comms)
#
# Created: WU-1019
# Updated: WU-1509 (project-wide lane granularity refactor)

# Framework Lane: @lumenflow packages
Framework:
  Core Lifecycle:
    description: 'Core lifecycle orchestration: WU flow, lane/worktree orchestration, backlog wiring'
    code_paths:
      - 'packages/@lumenflow/core/src/wu-*.ts'
      - 'packages/@lumenflow/core/src/lane-*.ts'
      - 'packages/@lumenflow/core/src/worktree-*.ts'
      - 'packages/@lumenflow/core/src/backlog-*.ts'
      - 'packages/@lumenflow/core/src/dependency-*.ts'
      - 'packages/@lumenflow/core/src/git-*.ts'
    keywords:
      - 'wu lifecycle'
      - 'claim done prep'
      - 'worktree flow'
      - 'lane lock'
      - 'dependency graph'
      - 'backlog sync'
      - 'git orchestration'
      - 'lifecycle engine'

  Core Validation:
    description: 'Core validation and quality gates: validators, schemas, invariants, linting guards'
    code_paths:
      - 'packages/@lumenflow/core/src/validation/**'
      - 'packages/@lumenflow/core/src/validators/**'
      - 'packages/@lumenflow/core/src/schemas/**'
      - 'packages/@lumenflow/core/src/invariants/**'
      - 'packages/@lumenflow/core/src/wu-validator.ts'
      - 'packages/@lumenflow/core/src/wu-validation*.ts'
      - 'packages/@lumenflow/core/src/manual-test-validator.ts'
      - 'packages/@lumenflow/core/src/prompt-linter.ts'
      - 'packages/@lumenflow/core/src/code-path-validator.ts'
      - 'packages/@lumenflow/core/src/system-map-validator.ts'
      - 'packages/@lumenflow/core/src/coverage-gate.ts'
    keywords:
      - 'validation'
      - 'schema'
      - 'strict checks'
      - 'invariants'
      - 'lint rules'
      - 'manual tests'
      - 'policy enforcement'
      - 'validator'

  Core State Recovery:
    description: 'Core state and recovery: state store, transactions, rollback, repair, cleanup'
    code_paths:
      - 'packages/@lumenflow/core/src/state-*.ts'
      - 'packages/@lumenflow/core/src/wu-state-*.ts'
      - 'packages/@lumenflow/core/src/*recover*.ts'
      - 'packages/@lumenflow/core/src/rollback-*.ts'
      - 'packages/@lumenflow/core/src/cleanup-*.ts'
      - 'packages/@lumenflow/core/src/merge-lock.ts'
      - 'packages/@lumenflow/core/src/cleanup-lock.ts'
      - 'packages/@lumenflow/core/src/wu-transaction*.ts'
      - 'packages/@lumenflow/core/src/stamp-*.ts'
      - 'packages/@lumenflow/core/src/orphan-detector.ts'
    keywords:
      - 'state store'
      - 'repair'
      - 'recover'
      - 'rollback'
      - 'transaction'
      - 'cleanup'
      - 'stamps'
      - 'orphan worktree'

  CLI WU Commands:
    description: 'CLI WU command surface: wu-* command behavior and WU CLI UX'
    code_paths:
      - 'packages/@lumenflow/cli/src/wu-*.ts'
      - 'packages/@lumenflow/cli/src/__tests__/wu-*.test.ts'
    keywords:
      - 'wu command'
      - 'wu:create'
      - 'wu:claim'
      - 'wu:done'
      - 'wu:prep'
      - 'wu:validate'
      - 'wu cli'
      - 'work unit commands'

  CLI Memory State:
    description: 'CLI memory and state commands: mem-*, state-*, signal-* command behavior'
    code_paths:
      - 'packages/@lumenflow/cli/src/mem-*.ts'
      - 'packages/@lumenflow/cli/src/state-*.ts'
      - 'packages/@lumenflow/cli/src/signal-*.ts'
      - 'packages/@lumenflow/cli/src/backlog-prune.ts'
      - 'packages/@lumenflow/cli/src/__tests__/mem-*.test.ts'
      - 'packages/@lumenflow/cli/src/__tests__/state-*.test.ts'
    keywords:
      - 'memory commands'
      - 'mem:init'
      - 'mem:checkpoint'
      - 'state doctor'
      - 'state cleanup'
      - 'signals'
      - 'checkpointing'
      - 'context memory'

  CLI Orchestration:
    description: 'CLI orchestration commands: initiative, spawn, orchestration, agent workflows'
    code_paths:
      - 'packages/@lumenflow/cli/src/initiative-*.ts'
      - 'packages/@lumenflow/cli/src/orchestrate-*.ts'
      - 'packages/@lumenflow/cli/src/spawn-*.ts'
      - 'packages/@lumenflow/cli/src/agent-*.ts'
      - 'packages/@lumenflow/cli/src/flow-*.ts'
      - 'packages/@lumenflow/cli/src/metrics-*.ts'
      - 'packages/@lumenflow/cli/src/__tests__/initiative-*.test.ts'
      - 'packages/@lumenflow/cli/src/__tests__/orchestrate-*.test.ts'
      - 'packages/@lumenflow/cli/src/__tests__/spawn-*.test.ts'
    keywords:
      - 'initiative'
      - 'orchestrate'
      - 'spawn'
      - 'agent workflow'
      - 'bulk assign'
      - 'flow report'
      - 'metrics snapshot'
      - 'coordination'

  CLI Enforcement:
    description: 'CLI enforcement/integration surface: hooks, gates, lane checks, install/bootstrap'
    code_paths:
      - 'packages/@lumenflow/cli/src/hooks/**'
      - 'packages/@lumenflow/cli/src/gates.ts'
      - 'packages/@lumenflow/cli/src/validate.ts'
      - 'packages/@lumenflow/cli/src/lane-*.ts'
      - 'packages/@lumenflow/cli/src/init.ts'
      - 'packages/@lumenflow/cli/src/doctor.ts'
      - 'packages/@lumenflow/cli/src/release.ts'
      - 'packages/@lumenflow/cli/src/docs-sync.ts'
      - 'packages/@lumenflow/cli/src/sync-templates.ts'
      - 'packages/@lumenflow/cli/src/public-manifest.ts'
      - 'packages/@lumenflow/cli/src/commands/integrate.ts'
      - 'packages/@lumenflow/cli/src/__tests__/hooks/**'
    keywords:
      - 'enforcement hooks'
      - 'gates'
      - 'lane health'
      - 'lane suggest'
      - 'bootstrap'
      - 'integration'
      - 'public manifest'
      - 'cli policy'

  MCP:
    description: 'MCP stdio server: Model Context Protocol server for AI agents'
    code_paths:
      - 'packages/@lumenflow/mcp/**'
      - 'packages/@lumenflow/mcp/src/**'
    keywords:
      - 'mcp'
      - 'model context protocol'
      - 'stdio'
      - 'server'
      - 'tools'
      - 'resources'
      - 'agent protocol'
      - 'npx @lumenflow/mcp'

  Memory:
    description: 'Memory layer: checkpoints, summarization, context management'
    code_paths:
      - 'packages/@lumenflow/memory/**'
      - 'packages/@lumenflow/memory/src/**'
    keywords:
      - 'memory'
      - 'checkpoint'
      - 'summarization'
      - 'context management'
      - 'mem:init'
      - 'mem:checkpoint'
      - 'conversation history'
      - 'token budget'

  Agent:
    description: 'Agent tooling: session management, issue logging, feedback'
    code_paths:
      - 'packages/@lumenflow/agent/**'
      - 'packages/@lumenflow/agent/src/**'
    keywords:
      - 'agent session'
      - 'issue logging'
      - 'feedback'
      - 'agent:session'
      - 'agent:log-issue'
      - 'triage'
      - 'escalation'
      - 'signal'

  Metrics:
    description: 'Metrics and analytics: DORA, flow reports, telemetry'
    code_paths:
      - 'packages/@lumenflow/metrics/**'
      - 'packages/@lumenflow/metrics/src/**'
    keywords:
      - 'metrics'
      - 'DORA'
      - 'flow report'
      - 'telemetry'
      - 'deployment frequency'
      - 'lead time'
      - 'change failure rate'
      - 'bottleneck analysis'

  Initiatives:
    description: 'Initiative orchestration: multi-WU coordination, bulk operations'
    code_paths:
      - 'packages/@lumenflow/initiatives/**'
      - 'packages/@lumenflow/initiatives/src/**'
    keywords:
      - 'initiative'
      - 'orchestration'
      - 'bulk assign'
      - 'initiative:create'
      - 'initiative:status'
      - 'multi-wu'
      - 'coordination'
      - 'spawning'

  Shims:
    description: 'Compatibility shims: platform adapters, polyfills'
    code_paths:
      - 'packages/@lumenflow/shims/**'
      - 'packages/@lumenflow/shims/src/**'
    keywords:
      - 'shim'
      - 'compatibility'
      - 'adapter'
      - 'polyfill'
      - 'platform'
      - 'browser'
      - 'node'
      - 'cross-platform'

# Operations Lane: Runtime, Tooling, and Automation
Operations:
  Runtime:
    description: 'Runtime app infrastructure and service code'
    code_paths:
      - 'apps/github-app/**'
    keywords:
      - 'runtime'
      - 'service'
      - 'github app runtime'
      - 'deployment target'
      - 'infra app'

  Tooling:
    description: 'Repository tooling, scripts, root config, and local automation'
    code_paths:
      - 'tools/**'
      - 'scripts/**'
      - '.husky/**'
      - 'packages/linters/**'
      - 'benchmark.js'
      - 'eslint.config.mjs'
      - 'prettier.config.mjs'
      - 'vitest.config.ts'
      - 'vitest.config.ts.timestamp-*.mjs'
      - 'tsconfig.json'
      - 'tsconfig.build.json'
      - 'turbo.json'
      - 'pnpm-workspace.yaml'
    keywords:
      - 'tooling'
      - 'script'
      - 'lint'
      - 'format'
      - 'vitest'
      - 'workspace'
      - 'turbo'
      - 'repo config'

  Automation:
    description: 'GitHub Actions and pipeline automation'
    code_paths:
      - '.github/**'
      - 'actions/**'
    keywords:
      - 'ci'
      - 'cd'
      - 'github actions'
      - 'workflow'
      - 'pipeline'
      - 'build'
      - 'release'
      - 'automation'

# Content Lane: Specifications, Framework docs, and site/comms
Content:
  Specs Governance:
    description: 'Governance specs, WU artifacts, and LumenFlow state/config docs'
    code_paths:
      - 'docs/04-operations/**'
      - '.lumenflow.config.yaml'
      - '.lumenflow.lane-inference.yaml'
      - '.lumenflow/**'
    keywords:
      - 'wu spec'
      - 'backlog'
      - 'status board'
      - 'governance'
      - 'workflow policy'
      - 'lumenflow config'
      - 'lane taxonomy'
      - 'operations docs'

  Framework Docs:
    description: 'Framework guidance and operating playbooks for contributors'
    code_paths:
      - 'docs/_frameworks/**'
      - 'LUMENFLOW.md'
      - 'START-HERE.md'
      - 'CLAUDE.md'
      - 'AGENTS.md'
    keywords:
      - 'framework docs'
      - 'onboarding'
      - 'playbook'
      - 'operating guide'
      - 'agent guidance'
      - 'workflow docs'

  Site Comms:
    description: 'Published docs site and outward-facing communication content'
    code_paths:
      - 'apps/docs/**'
      - 'docs/posts/**'
      - 'README.md'
      - 'CHANGELOG.md'
    keywords:
      - 'docs site'
      - 'starlight'
      - 'posts'
      - 'release notes'
      - 'readme'
      - 'external communication'
